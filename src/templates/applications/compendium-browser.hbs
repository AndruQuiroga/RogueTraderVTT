<form class="rt-compendium-browser">
    <header class="browser-header">
        <h1><i class="fas fa-search"></i> Rogue Trader Compendium Browser</h1>
        <p>Browse, filter, and search through all Rogue Trader compendia</p>
    </header>

    <div class="browser-body">
        <aside class="browser-sidebar">
            <div class="filter-section">
                <h3><i class="fas fa-filter"></i> Filters</h3>
                
                <div class="filter-group">
                    <label for="search-input">Search</label>
                    <input type="text" class="search-input" placeholder="Search by name..." value="{{filters.search}}">
                </div>

                <div class="filter-group">
                    <label for="filter-source">Source</label>
                    <select class="filter-source">
                        <option value="all">All Sources</option>
                        {{#each sources}}
                        <option value="{{this}}" {{#if (eq ../filters.source this)}}selected{{/if}}>{{this}}</option>
                        {{/each}}
                    </select>
                </div>

                <div class="filter-group">
                    <label for="filter-category">Category</label>
                    <select class="filter-category">
                        <option value="all">All Categories</option>
                        {{#each categories}}
                        <option value="{{this}}" {{#if (eq ../filters.category this)}}selected{{/if}}>{{this}}</option>
                        {{/each}}
                    </select>
                </div>

                <div class="filter-group">
                    <label for="filter-group-by">Group By</label>
                    <select class="filter-group-by">
                        {{#each groupByOptions}}
                        <option value="{{value}}" {{#if (eq ../filters.groupBy value)}}selected{{/if}}>{{label}}</option>
                        {{/each}}
                    </select>
                </div>
                
                {{#if hasArmourFilters}}
                <div class="filter-divider"></div>
                <h4 class="filter-subheader"><i class="fas fa-shield"></i> Armour Filters</h4>
                
                <div class="filter-group">
                    <label for="filter-armour-type">Armour Type</label>
                    <select class="filter-armour-type">
                        <option value="all">All Types</option>
                        {{#each armourTypes as |type key|}}
                        <option value="{{key}}" {{#if (eq ../filters.armourType key)}}selected{{/if}}>
                            {{localize type.label}}
                        </option>
                        {{/each}}
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="filter-min-ap">Minimum AP</label>
                    <input type="number" class="filter-min-ap" min="0" max="20" value="{{filters.minAP}}" placeholder="Any">
                </div>
                
                <div class="filter-group">
                    <label for="filter-coverage">Coverage</label>
                    <select class="filter-coverage">
                        <option value="all" {{#if (eq filters.coverage "all")}}selected{{/if}}>All Coverage</option>
                        <option value="full" {{#if (eq filters.coverage "full")}}selected{{/if}}>Full Body</option>
                        <option value="partial" {{#if (eq filters.coverage "partial")}}selected{{/if}}>Partial</option>
                    </select>
                </div>
                {{/if}}

                {{#if hasArmourModFilters}}
                <div class="filter-divider"></div>
                <h4 class="filter-subheader"><i class="fas fa-wrench"></i> Armour Modification Filters</h4>
                
                <div class="filter-group">
                    <label for="filter-mod-type">Applies To</label>
                    <select class="filter-mod-type">
                        <option value="all">All Armour Types</option>
                        {{#each armourTypesForMods as |type key|}}
                        <option value="{{key}}" {{#if (eq ../filters.modType key)}}selected{{/if}}>
                            {{localize type.label}}
                        </option>
                        {{/each}}
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>
                        <input type="checkbox" class="filter-has-modifiers" {{#if filters.hasModifiers}}checked{{/if}}>
                        Has Stat Modifiers
                    </label>
                </div>
                
                <div class="filter-group">
                    <label>
                        <input type="checkbox" class="filter-has-properties" {{#if filters.hasProperties}}checked{{/if}}>
                        Adds/Removes Properties
                    </label>
                </div>
                {{/if}}

                <button type="button" class="clear-filters" data-action="clearFilters">
                    <i class="fas fa-times"></i> Clear Filters
                </button>
            </div>
        </aside>

        <main class="browser-results">
            <div class="results-header">
                <h3>Results ({{results.length}} items)</h3>
            </div>
            
            <div class="results-list">
                {{#if results.length}}
                    {{#each groupedResults}}
                    <div class="results-group">
                        <div class="results-group-header">
                            <span class="results-group-title">{{label}}</span>
                            <span class="results-group-count">{{items.length}}</span>
                        </div>
                        {{#each items}}
                        <div class="compendium-item compendium-item--{{type}}" data-uuid="{{uuid}}" draggable="true">
                            <img src="{{img}}" alt="{{name}}" class="item-image" />
                            <div class="item-details">
                                <h4 class="item-name">{{name}}</h4>
                                
                                {{!-- Armour-specific metadata --}}
                                {{#if armourData}}
                                <div class="item-stats item-stats--armour">
                                    <span class="stat-badge stat-badge--type stat-badge--{{armourData.type}}">
                                        <i class="fas fa-shield"></i> {{armourData.typeLabel}}
                                    </span>
                                    <span class="stat-badge stat-badge--ap">
                                        <i class="fas fa-shield-halved"></i> {{armourData.apSummary}}
                                    </span>
                                    <span class="stat-badge stat-badge--coverage" title="Coverage: {{armourData.coverageIcons}}">
                                        <i class="fas fa-person"></i> {{armourData.coverageIcons}}
                                    </span>
                                    {{#if armourData.maxAgility}}
                                    <span class="stat-badge stat-badge--agility">
                                        <i class="fas fa-person-running"></i> Max {{armourData.maxAgility}}
                                    </span>
                                    {{/if}}
                                </div>
                                {{/if}}
                                
                                {{!-- Armour modification metadata --}}
                                {{#if armourModData}}
                                <div class="item-stats item-stats--armour-mod">
                                    <span class="stat-badge stat-badge--restrictions">
                                        <i class="fas fa-filter"></i> {{armourModData.restrictionLabel}}
                                    </span>
                                    
                                    {{#each armourModData.modifierBadges}}
                                    <span class="stat-badge stat-badge--modifier {{#unless positive}}stat-badge--negative{{/unless}}">
                                        <i class="fas fa-{{#if positive}}arrow-up{{else}}arrow-down{{/if}}"></i>
                                        {{label}}
                                    </span>
                                    {{/each}}
                                    
                                    {{#if armourModData.hasProperties}}
                                    <span class="stat-badge stat-badge--properties">
                                        <i class="fas fa-tags"></i> {{armourModData.propertiesSummary}}
                                    </span>
                                    {{/if}}
                                </div>
                                {{/if}}
                                
                                {{!-- Weapon quality metadata --}}
                                {{#if qualityData}}
                                <div class="item-stats item-stats--quality">
                                    {{#if qualityData.hasLevel}}
                                    <span class="stat-badge stat-badge--level">
                                        <i class="fas fa-layer-group"></i> Has Level{{#if qualityData.level}} ({{qualityData.level}}){{/if}}
                                    </span>
                                    {{/if}}
                                    <p class="quality-description">{{qualityData.description}}</p>
                                </div>
                                {{/if}}
                                
                                <div class="item-meta">
                                    <span class="item-type">{{type}}</span>
                                {{#if sourceLabel}}
                                <span class="item-source">{{sourceLabel}}</span>
                                {{/if}}
                                    <span class="item-pack">{{pack}}</span>
                                </div>
                            </div>
                        </div>
                        {{/each}}
                    </div>
                    {{/each}}
                {{else}}
                    <div class="no-results">
                        <i class="fas fa-search"></i>
                        <p>No items match your filters</p>
                    </div>
                {{/if}}
            </div>
        </main>
    </div>
</form>
