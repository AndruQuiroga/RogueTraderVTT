{{!-- Rogue Trader Character Sheet - Redesigned for RT --}}
<div class="rt-wrapper">
    <form class="rt-actor rt-sheet" autocomplete="off">
        {{!-- Character Header --}}
        <div class="rt-header rt-grid-col-6 rt-panel rt-character-header">
            <div class="rt-header__info rt-header-grid">
                <div class="rt-header-left">
                    <div class="rt-header-topline">
                        <div class="rt-header__logo rt-portrait-container">
                            <img class="rt-header__logo-image rt-portrait" src="{{actor.img}}" data-edit="img" alt="{{actor.name}}" title="{{actor.name}}" />
                        </div>
                        <div class="rt-header-info">
                            <div class="rt-header-row rt-name-row">
                                <span class="rt-header-label">{{localize "RT.Character.Name"}}</span>
                                <input class="rt-header-input rt-name-input" name="name" type="text" value="{{actor.name}}" />
                            </div>
                            <div class="rt-header-row rt-player-row">
                                <span class="rt-header-label">{{localize "RT.Character.Player"}}</span>
                                <input class="rt-header-input rt-player-input" name="system.bio.playerName" type="text" value="{{system.bio.playerName}}" placeholder="Player Name" />
                            </div>
                            <div class="rt-header-row">
                                <span class="rt-header-label">{{localize "RT.OriginPath.Career"}}</span>
                                <span class="rt-header-value">{{system.originPath.career}}</span>
                            </div>
                            <div class="rt-header-row">
                                <span class="rt-header-label">{{localize "RT.Character.Rank"}}</span>
                                <input class="rt-header-input rt-rank-input" name="system.rogueTrader.rank" type="text" value="{{system.rogueTrader.rank}}" placeholder="Rank" />
                            </div>
                            <div class="rt-header-row">
                                <span class="rt-header-label">{{localize "RT.OriginPath.HomeWorld"}}</span>
                                <span class="rt-header-value">{{system.originPath.homeWorld}}</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="rt-header-right">
                    <div class="rt-hud-stack">
                        {{!-- Characteristics HUD --}}
                        <div class="rt-characteristics-hud">
                            {{#each actor.characteristics as |characteristic name|}}
                                {{#unless (eq name "influence")}}
                                <div class="rt-char-hud-item {{#if (gt this.originPathModifier 0)}}rt-char-bonus{{/if}}{{#if (lt this.originPathModifier 0)}}rt-char-penalty{{/if}}">
                                    <button
                                        class="rt-char-hud-name roll-characteristic actor-drag"
                                        type="roll"
                                        data-item-type="characteristic"
                                        data-item-id="{{name}}"
                                        data-characteristic="{{name}}"
                                        title="{{this.label}}"
                                    >{{this.short}}</button>
                                    <div class="rt-char-hud-circle" title="{{this.label}}">
                                        <span class="rt-char-hud-mod">{{this.hudMod}}</span>
                                        <span class="rt-char-hud-mod-label">MOD</span>
                                    </div>
                                    <div class="rt-char-hud-base">Total {{this.hudTotal}}</div>
                                    <label class="rt-char-hud-toggle sheet-control__hide-control" data-toggle="charhud_{{name}}" title="Edit {{this.label}}">
                                        <span class="rt-char-hud-toggle-icon">v</span>
                                    </label>
                                    <div class="rt-char-hud-details charhud_{{name}}" {{hideIfNot (isExpanded (concat 'charhud_' name ) @root.actor)}}>
                                        <label class="rt-char-hud-field">
                                            <span class="rt-char-hud-field-label">Base</span>
                                            <input type="number" name="system.characteristics.{{name}}.base" data-dtype="Number" value="{{this.base}}" />
                                        </label>
                                        <label class="rt-char-hud-field">
                                            <span class="rt-char-hud-field-label">Advances</span>
                                            <select name="system.characteristics.{{name}}.advance">
                                                {{option "0" this.advance "None"}}
                                                {{option "1" this.advance "Simple"}}
                                                {{option "2" this.advance "Intermediate"}}
                                                {{option "3" this.advance "Trained"}}
                                                {{option "4" this.advance "Proficient"}}
                                                {{option "5" this.advance "Expert"}}
                                            </select>
                                        </label>
                                        <label class="rt-char-hud-field">
                                            <span class="rt-char-hud-field-label">Unnatural</span>
                                            <select name="system.characteristics.{{name}}.unnatural" class="rt-unnatural-select" data-dtype="Number">
                                                <option value="0" {{#if (eq this.unnatural 0)}}selected{{/if}}>—</option>
                                                <option value="2" {{#if (eq this.unnatural 2)}}selected{{/if}}>×2</option>
                                                <option value="3" {{#if (eq this.unnatural 3)}}selected{{/if}}>×3</option>
                                                <option value="4" {{#if (eq this.unnatural 4)}}selected{{/if}}>×4</option>
                                            </select>
                                        </label>
                                    </div>
                                </div>
                                {{/unless}}
                            {{/each}}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {{!-- Navigation Tabs --}}
        <div class="rt-main-layout">
            <div class="rt-navigation" data-group="primary">
                <label class="rt-navigation__item rt-nav-item">
                    <a class="item" data-tab="overview" data-group="primary">Overview</a>
                </label>
                <label class="rt-navigation__item rt-nav-item">
                    <a class="item" data-tab="combat" data-group="primary">Combat</a>
                </label>
                <label class="rt-navigation__item rt-nav-item">
                    <a class="item" data-tab="abilities" data-group="primary">Skills</a>
                </label>
                <label class="rt-navigation__item rt-nav-item">
                    <a class="item" data-tab="specialties" data-group="primary">Talents</a>
                </label>
                <label class="rt-navigation__item rt-nav-item">
                    <a class="item" data-tab="equipment" data-group="primary">Equipment</a>
                </label>
                <label class="rt-navigation__item rt-nav-item">
                    <a class="item" data-tab="powers" data-group="primary">Powers</a>
                </label>
                <label class="rt-navigation__item rt-nav-item">
                    <a class="item" data-tab="dynasty" data-group="primary">Dynasty</a>
                </label>
                <label class="rt-navigation__item rt-nav-item">
                    <a class="item" data-tab="bio" data-group="primary">Biography</a>
                </label>
            </div>

            {{!-- Tab Content --}}
            <section class="rt-body">
            {{!-- OVERVIEW TAB --}}
            <div class="tab rt-tab rt-tab-overview" data-group="primary" data-tab="overview">
                
                {{!-- Two Column Layout --}}
                <div class="rt-overview-grid">
                    {{!-- Left Column --}}
                    <div class="rt-overview-col">
                        {{!-- Wounds Panel V2 - Redesigned with pip system and interactive controls --}}
                        {{> systems/rogue-trader/templates/actor/panel/wounds-panel-v2.hbs}}

                        {{!-- Fatigue Panel V2 - Redesigned with auto-calc transparency and manual override --}}
                        {{> systems/rogue-trader/templates/actor/panel/fatigue-panel-v2.hbs}}

                        {{!-- Corruption Panel V2 - Redesigned with degree badges, threshold warnings, malignancy tracking --}}
                        {{> systems/rogue-trader/templates/actor/panel/corruption-panel-v2.hbs}}

                        {{!-- Insanity Panel V2 - Redesigned with degree badges, threshold warnings, mental disorder tracking --}}
                        {{> systems/rogue-trader/templates/actor/panel/insanity-panel-v2.hbs}}
                    </div>

                    {{!-- Right Column --}}
                    <div class="rt-overview-col">
                        {{!-- Fate Panel V2 - Redesigned with golden star pips and spending menu --}}
                        {{> systems/rogue-trader/templates/actor/panel/fate-panel-v2.hbs}}

                        {{!-- Movement & Capacity --}}
                        <div class="rt-panel rt-panel-movement">
                            <div class="rt-panel-header">
                                <span class="rt-panel-title"><i class="fas fa-running"></i> Movement & Capacity</span>
                            </div>
                            <div class="rt-panel-body">
                                <div class="rt-movement-grid">
                                    <div class="rt-move-cell">
                                        <span class="rt-move-label">Half</span>
                                        <span class="rt-move-value">{{actor.movement.half}}m</span>
                                    </div>
                                    <div class="rt-move-cell">
                                        <span class="rt-move-label">Full</span>
                                        <span class="rt-move-value">{{actor.movement.full}}m</span>
                                    </div>
                                    <div class="rt-move-cell">
                                        <span class="rt-move-label">Charge</span>
                                        <span class="rt-move-value">{{actor.movement.charge}}m</span>
                                    </div>
                                    <div class="rt-move-cell">
                                        <span class="rt-move-label">Run</span>
                                        <span class="rt-move-value">{{actor.movement.run}}m</span>
                                    </div>
                                </div>
                                <div class="rt-capacity-row">
                                    <div class="rt-capacity-item">
                                        <span class="rt-capacity-label">Carry</span>
                                        <span class="rt-capacity-value">{{actor.encumbrance.current}} / {{actor.encumbrance.max}} kg</span>
                                    </div>
                                    <div class="rt-capacity-item">
                                        <span class="rt-capacity-label">Size</span>
                                        <span class="rt-capacity-value">{{actor.size}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {{!-- Active Effects --}}
                        {{> systems/rogue-trader/templates/actor/panel/active-effects-panel.hbs}}
                    </div>
                </div>
            </div>

            {{!-- COMBAT TAB --}}
            <div class="tab rt-tab rt-tab-combat" data-group="primary" data-tab="combat">
                {{> systems/rogue-trader/templates/actor/panel/combat-station-panel.hbs}}
            </div>

            {{!-- ABILITIES TAB --}}
            <div class="tab rt-tab rt-tab-abilities" data-group="primary" data-tab="abilities">
                {{!-- Skills Panel --}}
                <div class="rt-panel">
                    <div class="rt-panel-header">
                        <span class="rt-panel-title"><i class="fas fa-book"></i> Skills</span>
                    </div>
                    <div class="rt-panel-body">
                        {{> systems/rogue-trader/templates/actor/panel/skills-panel.hbs}}
                    </div>
                </div>
            </div>

            {{!-- SPECIALTIES TAB --}}
            <div class="tab rt-tab rt-specialties-layout" data-group="primary" data-tab="specialties">
                <div class="rt-specialties-left">
                    {{> systems/rogue-trader/templates/actor/panel/skills-specialist-panel.hbs}}
                </div>
                <div class="rt-specialties-right">
                    {{> systems/rogue-trader/templates/actor/panel/talent-panel.hbs}}
                    {{> systems/rogue-trader/templates/actor/panel/trait-panel.hbs}}
                </div>
            </div>

            {{!-- POWERS TAB --}}
            <div class="tab rt-tab rt-tab-powers" data-group="primary" data-tab="powers">
                <div class="rt-powers-grid">
                    {{!-- Left Column: Psy Rating & Psychic Powers --}}
                    <div class="rt-powers-col">
                        {{> systems/rogue-trader/templates/actor/panel/psy-panel.hbs}}
                        {{> systems/rogue-trader/templates/actor/panel/psychic-powers-panel.hbs}}
                    </div>
                    
                    {{!-- Right Column: Navigator, Orders, Rituals --}}
                    <div class="rt-powers-col">
                        {{> systems/rogue-trader/templates/actor/panel/navigator-powers-panel.hbs}}
                        {{> systems/rogue-trader/templates/actor/panel/orders-panel.hbs}}
                        {{> systems/rogue-trader/templates/actor/panel/rituals-panel.hbs}}
                    </div>
                </div>
            </div>

            {{!-- EQUIPMENT TAB --}}
            <div class="tab rt-tab rt-tab-equipment" data-group="primary" data-tab="equipment">
                {{> systems/rogue-trader/templates/actor/panel/loadout-equipment-panel.hbs}}
            </div>

            {{!-- DYNASTY TAB --}}
            <div class="tab rt-tab rt-tab-dynasty" data-group="primary" data-tab="dynasty">
                <div class="rt-dynasty-grid">
                    {{!-- Left Column --}}
                    <div class="rt-dynasty-col">
                        {{!-- Profit Factor Panel --}}
                        <div class="rt-panel rt-panel-profit">
                            <div class="rt-panel-header">
                                <span class="rt-panel-title"><i class="fas fa-coins"></i> Profit Factor</span>
                            </div>
                            <div class="rt-panel-body">
                                <div class="rt-profit-main-display">
                                    <div class="rt-profit-current">
                                        <span class="rt-profit-label">Current PF</span>
                                        <input type="number" class="rt-profit-value-input" name="system.rogueTrader.profitFactor.current" value="{{system.rogueTrader.profitFactor.current}}" data-dtype="Number" />
                                    </div>
                                    <div class="rt-profit-starting">
                                        <span class="rt-profit-label">Starting</span>
                                        <input type="number" class="rt-vital-input" name="system.rogueTrader.profitFactor.starting" value="{{system.rogueTrader.profitFactor.starting}}" data-dtype="Number" />
                                    </div>
                                </div>
                                <div class="rt-misfortunes">
                                    <label class="rt-field-label">Misfortunes & PF Changes</label>
                                    <textarea class="rt-textarea" name="system.rogueTrader.profitFactor.misfortunes" rows="3" placeholder="Record any losses or gains to Profit Factor...">{{system.rogueTrader.profitFactor.misfortunes}}</textarea>
                                </div>
                            </div>
                        </div>
                        
                        {{!-- Experience Panel --}}
                        <div class="rt-panel">
                            <div class="rt-panel-header">
                                <span class="rt-panel-title"><i class="fas fa-star"></i> Experience</span>
                            </div>
                            <div class="rt-panel-body">
                                <div class="rt-xp-display">
                                    <div class="rt-xp-item">
                                        <span class="rt-xp-label">Total</span>
                                        <input type="number" class="rt-vital-input" name="system.experience.total" value="{{actor.system.experience.total}}" data-dtype="Number" />
                                    </div>
                                    <div class="rt-xp-item">
                                        <span class="rt-xp-label">Spent</span>
                                        <input type="number" class="rt-vital-input" name="system.experience.used" value="{{actor.system.experience.used}}" data-dtype="Number" />
                                    </div>
                                    <div class="rt-xp-item rt-xp-available">
                                        <span class="rt-xp-label">Available</span>
                                        <span class="rt-xp-value">{{actor.system.experience.available}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        {{!-- Ship Role --}}
                        {{> systems/rogue-trader/templates/actor/panel/ship-role-panel.hbs}}
                    </div>
                    
                    {{!-- Right Column --}}
                    <div class="rt-dynasty-col">
                        {{!-- Acquisitions --}}
                        {{> systems/rogue-trader/templates/actor/panel/acquisitions-panel.hbs}}
                        
                        {{!-- Endeavour Tracker (new feature) --}}
                        <div class="rt-panel">
                            <div class="rt-panel-header">
                                <span class="rt-panel-title"><i class="fas fa-map-marked-alt"></i> Current Endeavour</span>
                            </div>
                            <div class="rt-panel-body">
                                <div class="rt-endeavour-fields">
                                    <div class="rt-field-row">
                                        <label class="rt-field-label">Endeavour Name</label>
                                        <input type="text" class="rt-field-input" name="system.rogueTrader.endeavour.name" value="{{system.rogueTrader.endeavour.name}}" placeholder="Name of current endeavour..." />
                                    </div>
                                    <div class="rt-field-row rt-field-row-split">
                                        <div class="rt-field-half">
                                            <label class="rt-field-label">Achievement Points</label>
                                            <div class="rt-ap-tracker">
                                                <input type="number" class="rt-vital-input" name="system.rogueTrader.endeavour.achievementCurrent" value="{{system.rogueTrader.endeavour.achievementCurrent}}" data-dtype="Number" />
                                                <span>/</span>
                                                <input type="number" class="rt-vital-input" name="system.rogueTrader.endeavour.achievementRequired" value="{{system.rogueTrader.endeavour.achievementRequired}}" data-dtype="Number" />
                                            </div>
                                        </div>
                                        <div class="rt-field-half">
                                            <label class="rt-field-label">PF Reward</label>
                                            <input type="number" class="rt-vital-input" name="system.rogueTrader.endeavour.reward" value="{{system.rogueTrader.endeavour.reward}}" data-dtype="Number" />
                                        </div>
                                    </div>
                                    <div class="rt-field-row">
                                        <label class="rt-field-label">Objectives & Notes</label>
                                        <textarea class="rt-textarea" name="system.rogueTrader.endeavour.notes" rows="3" placeholder="Track objectives and progress...">{{system.rogueTrader.endeavour.notes}}</textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {{!-- BIOGRAPHY TAB --}}
            <div class="tab rt-tab rt-tab-bio" data-group="primary" data-tab="bio">
                <div class="rt-bio-grid">
                    {{!-- Left Column: Identity & Origin --}}
                    <div class="rt-bio-col">
                        {{!-- Identity Panel --}}
                        <div class="rt-panel">
                            <div class="rt-panel-header">
                                <span class="rt-panel-title"><i class="fas fa-user"></i> Identity</span>
                            </div>
                            <div class="rt-panel-body">
                                <div class="rt-identity-grid">
                                    <div class="rt-field-row">
                                        <label class="rt-field-label">Gender</label>
                                        <input type="text" class="rt-field-input" name="system.bio.gender" value="{{system.bio.gender}}" />
                                    </div>
                                    <div class="rt-field-row">
                                        <label class="rt-field-label">Age</label>
                                        <input type="text" class="rt-field-input" name="system.bio.age" value="{{system.bio.age}}" />
                                    </div>
                                    <div class="rt-field-row">
                                        <label class="rt-field-label">Build</label>
                                        <input type="text" class="rt-field-input" name="system.bio.build" value="{{system.bio.build}}" />
                                    </div>
                                    <div class="rt-field-row">
                                        <label class="rt-field-label">Complexion</label>
                                        <input type="text" class="rt-field-input" name="system.bio.complexion" value="{{system.bio.complexion}}" />
                                    </div>
                                    <div class="rt-field-row">
                                        <label class="rt-field-label">Hair</label>
                                        <input type="text" class="rt-field-input" name="system.bio.hair" value="{{system.bio.hair}}" />
                                    </div>
                                    <div class="rt-field-row">
                                        <label class="rt-field-label">Eyes</label>
                                        <input type="text" class="rt-field-input" name="system.bio.eyes" value="{{system.bio.eyes}}" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        {{!-- Origin Path Panel --}}
                        <div class="rt-panel">
                            <div class="rt-panel-header">
                                <span class="rt-panel-title"><i class="fas fa-route"></i> Origin Path</span>
                            </div>
                            <div class="rt-panel-body">
                                <div class="rt-origin-path">
                                    {{#each originPathSteps as |step|}}
                                    <div class="rt-origin-step {{#if step.item}}rt-filled{{/if}}" data-step="{{step.key}}">
                                        <span class="rt-origin-label">{{step.label}}</span>
                                        {{#if step.item}}
                                        <div class="rt-origin-choice" data-item-id="{{step.item._id}}">
                                            <img src="{{step.item.img}}" alt="" class="rt-origin-img" />
                                            <div class="rt-origin-info">
                                                <span class="rt-origin-name item-edit" data-item-id="{{step.item._id}}">{{step.item.name}}</span>
                                                {{#if step.item.system.description}}
                                                    <span class="rt-origin-summary">{{removeMarkup step.item.system.description}}</span>
                                                {{else if step.item.system.benefit}}
                                                    <span class="rt-origin-summary">{{removeMarkup step.item.system.benefit}}</span>
                                                {{/if}}
                                            </div>
                                            <button type="button" class="rt-origin-remove item-delete" data-item-id="{{step.item._id}}"><i class="fas fa-times"></i></button>
                                        </div>
                                        {{else}}
                                        <div class="rt-origin-empty">
                                            <span class="rt-origin-empty-title">Awaiting Destiny</span>
                                            <span class="rt-origin-empty-sub">Drop an origin here</span>
                                        </div>
                                        {{/if}}
                                    </div>
                                    {{/each}}
                                </div>
                            </div>
                        </div>
                        
                        {{!-- Connections Panel --}}
                        <div class="rt-panel">
                            <div class="rt-panel-header">
                                <span class="rt-panel-title"><i class="fas fa-users"></i> Connections</span>
                            </div>
                            <div class="rt-panel-body">
                                <div class="rt-connections-section">
                                    <div class="rt-affliction-header">
                                        <span>Peers</span>
                                        <button type="button" class="rt-add-btn item-create" data-type="peer"><i class="fas fa-plus"></i></button>
                                    </div>
                                    <div class="rt-affliction-list">
                                        {{#each actor.items as |item|}}
                                            {{#if item.isPeer}}
                                            <div class="rt-affliction-row">
                                                <span class="rt-affliction-name item-edit" data-item-id="{{item.id}}">{{item.name}}</span>
                                                <span class="rt-connection-bonus">+{{item.system.modifier}}</span>
                                                <button type="button" class="rt-affliction-del item-delete" data-item-id="{{item.id}}"><i class="fas fa-times"></i></button>
                                            </div>
                                            {{/if}}
                                        {{/each}}
                                    </div>
                                </div>
                                <div class="rt-connections-section">
                                    <div class="rt-affliction-header">
                                        <span>Enemies</span>
                                        <button type="button" class="rt-add-btn item-create" data-type="enemy"><i class="fas fa-plus"></i></button>
                                    </div>
                                    <div class="rt-affliction-list">
                                        {{#each actor.items as |item|}}
                                            {{#if item.isEnemy}}
                                            <div class="rt-affliction-row">
                                                <span class="rt-affliction-name item-edit" data-item-id="{{item.id}}">{{item.name}}</span>
                                                <span class="rt-connection-penalty">{{item.system.modifier}}</span>
                                                <button type="button" class="rt-affliction-del item-delete" data-item-id="{{item.id}}"><i class="fas fa-times"></i></button>
                                            </div>
                                            {{/if}}
                                        {{/each}}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    {{!-- Right Column: Journal/Notes --}}
                    <div class="rt-bio-col">
                        {{!-- Character Notes / Journal --}}
                        <div class="rt-panel rt-panel-journal">
                            <div class="rt-panel-header">
                                <span class="rt-panel-title"><i class="fas fa-book-open"></i> Character Journal</span>
                            </div>
                            <div class="rt-panel-body rt-journal-body">
                                <div class="rt-journal-section">
                                    <label class="rt-field-label">Personality & Quirks</label>
                                    <textarea class="rt-textarea" name="system.bio.quirks" rows="2" placeholder="Distinctive habits, mannerisms, beliefs...">{{system.bio.quirks}}</textarea>
                                </div>
                                <div class="rt-journal-section">
                                    <label class="rt-field-label">Superstitions & Rituals</label>
                                    <textarea class="rt-textarea" name="system.bio.superstition" rows="2" placeholder="Personal beliefs and observances...">{{system.bio.superstition}}</textarea>
                                </div>
                                <div class="rt-journal-section">
                                    <label class="rt-field-label">Treasured Mementos</label>
                                    <textarea class="rt-textarea" name="system.bio.mementos" rows="2" placeholder="Important possessions and keepsakes...">{{system.bio.mementos}}</textarea>
                                </div>
                                {{> systems/rogue-trader/templates/actor/panel/journal-panel.hbs includePanel=false}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        </div>
    </form>
</div>
