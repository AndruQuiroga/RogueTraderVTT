{{!-- Traits Panel - Compact Table View with Grouping --}}
<div class="rt-panel rt-panel-traits-table">
    <div class="rt-panel-header">
        <span class="rt-panel-title">
            <i class="fas fa-shield-alt"></i> Traits
        </span>
    </div>
    
    <div class="rt-panel-body">
        {{!-- Grouped Trait Table --}}
        {{#if traits.length}}
        <div class="rt-traits-grouped">
            {{#each groupedByCategory as |group|}}
            <div class="rt-trait-group">
                <div class="rt-group-header {{traitCategoryColor group.category}}">
                    <i class="fas {{traitIcon group.category}}"></i>
                    <span class="rt-group-title">{{group.categoryLabel}}</span>
                    <span class="rt-count-badge">{{group.traits.length}}</span>
                </div>
                
                <div class="rt-traits-table" data-category="{{group.category}}">
                    {{#each group.traits as |trait|}}
                    <div class="rt-trait-row item-drag" 
                         data-item-id="{{trait.id}}" 
                         draggable="true">
                        {{!-- Compact View --}}
                        <div class="rt-row-compact">
                            <i class="fas {{trait.categoryIcon}} rt-row-icon-inline"></i>
                            
                            <div class="rt-row-main">
                                <span class="rt-row-name" 
                                      data-action="itemEdit" 
                                      data-item-id="{{trait.id}}" 
                                      title="{{trait.fullName}}">
                                    {{trait.name}}
                                </span>
                                
                                {{#if trait.system.requirements}}
                                <div class="rt-row-meta">
                                    <span class="rt-meta-item">
                                        <i class="fas fa-lock"></i> {{trait.system.requirements}}
                                    </span>
                                </div>
                                {{/if}}
                            </div>
                            
                            {{!-- Level Stepper for variable traits --}}
                            {{#if trait.hasLevel}}
                            <div class="rt-level-stepper">
                                <button type="button" 
                                        class="rt-stepper-btn" 
                                        data-action="adjustTraitLevel" 
                                        data-item-id="{{trait.id}}" 
                                        data-delta="-1"
                                        title="Decrease Level">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <span class="rt-level-display">{{trait.system.level}}</span>
                                <button type="button" 
                                        class="rt-stepper-btn" 
                                        data-action="adjustTraitLevel" 
                                        data-item-id="{{trait.id}}" 
                                        data-delta="1"
                                        title="Increase Level">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            {{/if}}
                            
                            <div class="rt-row-actions">
                                <button type="button" class="rt-action-btn rt-btn-expand" data-action="toggleTraitExpand" data-item-id="{{trait.id}}" title="Show Details">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <button type="button" 
                                        class="rt-action-btn" 
                                        data-action="itemVocalize" 
                                        data-item-id="{{trait.id}}" 
                                        title="Send to Chat">
                                    <i class="fas fa-comment"></i>
                                </button>
                                <button type="button" 
                                        class="rt-action-btn rt-btn-danger" 
                                        data-action="itemDelete" 
                                        data-item-id="{{trait.id}}" 
                                        title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        
                        {{!-- Expanded Details --}}
                        <div class="rt-row-expanded" style="display: none;">
                            {{#if trait.system.benefit}}
                            <div class="rt-detail-row rt-detail-benefit">
                                <span class="rt-detail-label">Benefit:</span>
                                <div class="rt-detail-content">{{{trait.system.benefit}}}</div>
                            </div>
                            {{/if}}
                            
                            {{#if trait.system.notes}}
                            <div class="rt-detail-row">
                                <span class="rt-detail-label">Notes:</span>
                                <span class="rt-detail-value">{{trait.system.notes}}</span>
                            </div>
                            {{/if}}
                        </div>
                    </div>
                    {{/each}}
                </div>
            </div>
            {{/each}}
        </div>
        {{/if}}
        
        {{!-- Dropzone --}}
        <div class="rt-dropzone" data-action="itemCreate" data-type="trait">
            <i class="fas fa-shield-alt rt-dropzone-icon"></i>
            <span class="rt-dropzone-text">Drop Trait or Click to Create</span>
        </div>
    </div>
</div>
