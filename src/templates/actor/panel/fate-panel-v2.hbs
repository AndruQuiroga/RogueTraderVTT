{{!-- Redesigned Fate Panel - Compact Golden Stars Only --}}
<div class="rt-panel rt-fate-panel-v2">

    {{!-- Panel Header - Click to expand/collapse --}}
    <div class="rt-panel-header rt-panel-header--clickable sheet-control__hide-control"
         data-toggle="fate_details"
         title="Click to {{#if (isExpanded 'fate_details' actor)}}collapse{{else}}expand{{/if}}">
        <span class="rt-panel-title">
            <i class="fas fa-star"></i> Fate
        </span>
        <i class="fas fa-chevron-down rt-panel-chevron {{#if (isExpanded 'fate_details' actor)}}rt-panel-chevron--open{{/if}}"></i>
    </div>

    {{!-- Panel Body --}}
    <div class="rt-panel-body">

        {{!-- Main Display: Star Pips Only --}}
        <div class="rt-fate-display-compact">

            {{!-- Star Pip Display --}}
            <div class="rt-fate-pips-compact">
                {{#if (gt system.fate.max 0)}}
                    {{#each (range 1 (add system.fate.max 1)) as |index|}}
                        <button type="button"
                                class="rt-fate-star {{#if (lte index ../system.fate.value)}}rt-fate-star--filled{{/if}}"
                                data-action="setFateStar"
                                data-fate-index="{{index}}"
                                title="Fate Point {{index}}{{#if (lte index ../system.fate.value)}} (Available){{else}} (Spent){{/if}}">
                            <i class="fas fa-star"></i>
                        </button>
                    {{/each}}
                {{else}}
                    <div class="rt-fate-empty">
                        <i class="far fa-star"></i>
                        <span>No Fate Points</span>
                    </div>
                {{/if}}
            </div>

            {{!-- Quick Actions --}}
            {{#if (gt system.fate.max 0)}}
            <div class="rt-fate-actions-compact">
                <button type="button"
                        class="rt-quick-action-btn"
                        data-action="restoreFate"
                        title="Restore all fate points">
                    <i class="fas fa-redo"></i>
                    <span>Restore All</span>
                </button>
            </div>
            {{/if}}

        </div>

        {{!-- Edit Mode (Expandable) --}}
        <div class="rt-panel-details fate_details" {{hideIfNot (isExpanded 'fate_details' actor)}}>

            {{!-- Quick Edit Section --}}
            <div class="rt-fate-edit-section">
                <div class="rt-fate-edit-header">
                    <i class="fas fa-cog"></i> Edit Fate Points
                </div>

                <div class="rt-fate-edit-grid">
                    <label class="rt-edit-field">
                        <span class="rt-edit-label">Max Fate Points</span>
                        <input type="number"
                               data-dtype="Number"
                               class="rt-edit-input"
                               name="system.fate.max"
                               value="{{system.fate.max}}"
                               min="0"
                               max="10"
                               placeholder="Max" />
                    </label>

                    <label class="rt-edit-field">
                        <span class="rt-edit-label">Current Fate</span>
                        <input type="number"
                               data-dtype="Number"
                               class="rt-edit-input"
                               name="system.fate.value"
                               value="{{system.fate.value}}"
                               min="0"
                               max="{{system.fate.max}}"
                               placeholder="Current" />
                    </label>
                </div>
            </div>

            {{!-- Star Pips (Edit Mode) - Click to set exact value --}}
            <div class="rt-fate-edit-section">
                <div class="rt-fate-edit-header">
                    <i class="fas fa-star"></i> Set Fate Points
                </div>
                <div class="rt-fate-pips rt-fate-pips-edit">
                    {{#each (range 0 (add system.fate.max 1)) as |index|}}
                        <button type="button"
                                class="rt-fate-star {{#if (lte index ../system.fate.value)}}rt-fate-star--filled{{/if}}"
                                data-action="setFateStar"
                                data-fate-index="{{index}}"
                                title="Set to {{index}} fate points">
                            <i class="fas fa-star"></i>
                        </button>
                    {{/each}}
                </div>
            </div>

        </div>
    </div>
</div>
