{{!-- Active Effects Panel - Card/Row Structure --}}
<div class="rt-panel rt-effects-panel">
    <div class="rt-panel-header rt-panel-header--clickable sheet-control__hide-control"
         data-toggle="effects_details"
         title="Click to {{#if (isExpanded 'effects_details' actor)}}collapse{{else}}expand{{/if}}">
        <span class="rt-panel-title">
            <i class="fas fa-sparkles"></i> Active Effects
            {{#if effects.length}}
                <span class="rt-badge">{{effects.length}}</span>
            {{/if}}
        </span>
        <i class="fas fa-chevron-down rt-panel-chevron {{#if (isExpanded 'effects_details' actor)}}rt-panel-chevron--open{{/if}}"></i>
    </div>

    <div class="rt-panel-body">
        
        {{#if effects.length}}
            <div class="rt-effects-list">
                {{#each effects as |effect|}}
                    <div class="rt-effect-card {{#if effect.disabled}}rt-effect-disabled{{/if}}" data-effect-id="{{effect.id}}">
                        
                        {{!-- Effect Header --}}
                        <div class="rt-effect-card-header">
                            <img src="{{effect.icon}}" class="rt-effect-icon" alt="{{effect.label}}" />
                            
                            <div class="rt-effect-info">
                                <div class="rt-effect-name">{{effect.label}}</div>
                                {{#if effect.sourceName}}
                                    <div class="rt-effect-source">
                                        <i class="fas fa-link"></i> {{effect.sourceName}}
                                    </div>
                                {{/if}}
                            </div>
                            
                            <div class="rt-effect-controls">
                                <button type="button" 
                                        class="rt-effect-btn rt-effect-toggle" 
                                        data-action="effectToggle"
                                        data-effect-id="{{effect.id}}"
                                        title="{{#if effect.disabled}}Enable{{else}}Disable{{/if}} Effect">
                                    <i class="fas {{#if effect.disabled}}fa-toggle-off{{else}}fa-toggle-on{{/if}}"></i>
                                </button>
                                
                                <button type="button" 
                                        class="rt-effect-btn rt-effect-edit" 
                                        data-action="effectEdit"
                                        data-effect-id="{{effect.id}}"
                                        title="Edit Effect">
                                    <i class="fas fa-edit"></i>
                                </button>
                                
                                <button type="button" 
                                        class="rt-effect-btn rt-effect-delete" 
                                        data-action="effectDelete"
                                        data-effect-id="{{effect.id}}"
                                        title="Delete Effect">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>

                        {{!-- Effect Changes (if expanded) --}}
                        {{#if (isExpanded 'effects_details' ../actor)}}
                            {{#if effect.changes.length}}
                                <div class="rt-effect-changes">
                                    {{#each effect.changes as |change|}}
                                        <div class="rt-effect-change">
                                            <span class="rt-change-key">{{change.key}}</span>
                                            <span class="rt-change-mode">{{lookup ../changeModeLookup change.mode}}</span>
                                            <span class="rt-change-value">{{change.value}}</span>
                                        </div>
                                    {{/each}}
                                </div>
                            {{/if}}
                        {{/if}}
                    </div>
                {{/each}}
            </div>
        {{/if}}
        
        <div class="rt-dropzone effect-create" data-action="effectCreate">
            <i class="fas fa-sparkles rt-dropzone-icon"></i>
            <span class="rt-dropzone-text">Drop effects here or click to create</span>
        </div>
    </div>
</div>

