{{!-- 
  Rogue Trader Gear Item Sheet - V2 Complete Redesign
  Matches weapon sheet pattern with modern ApplicationV2 structure
--}}
<div class="rt-gear-sheet">
  <form autocomplete="off">
    
    {{!-- ═══════════════════════════════════════════════════════════════════
         HEADER: Compact gear identity with category
    ═══════════════════════════════════════════════════════════════════ --}}
    <header class="rt-gear-header">
      <div class="rt-gear-header__image" data-action="editImage" data-edit="img">
        <img src="{{item.img}}" alt="{{item.name}}" />
        <div class="rt-gear-header__image-overlay">
          <i class="fas fa-edit"></i>
        </div>
      </div>
      
      <div class="rt-gear-header__info">
        <input type="text" class="rt-gear-header__name" name="name" value="{{item.name}}" placeholder="Gear Name" />
        
        <div class="rt-gear-header__meta">
          <span class="rt-gear-badge rt-gear-badge--category rt-gear-badge--{{system.category}}" title="Category">
            <i class="fas {{categoryIcon}}"></i>
            {{categoryLabel}}
          </span>
          {{#if (ne system.craftsmanship "common")}}
          <span class="rt-gear-badge rt-gear-badge--craft rt-gear-badge--{{system.craftsmanship}}" title="Craftsmanship">
            <i class="fas fa-hammer"></i>
            {{system.craftsmanshipLabel}}
          </span>
          {{/if}}
          {{#if (gt system.quantity 1)}}
          <span class="rt-gear-badge rt-gear-badge--quantity" title="Quantity">
            <i class="fas fa-layer-group"></i>
            ×{{system.quantity}}
          </span>
          {{/if}}
        </div>
      </div>
      
      <div class="rt-gear-header__equipped">
        <label class="rt-toggle-equipped" title="Toggle Equipped">
          <input type="checkbox" name="system.equipped" {{checked system.equipped}} />
          <span class="rt-toggle-equipped__indicator">
            <i class="fas {{#if system.equipped}}fa-check-circle{{else}}fa-circle{{/if}}"></i>
          </span>
          <span class="rt-toggle-equipped__label">{{#if system.equipped}}Equipped{{else}}Stowed{{/if}}</span>
        </label>
      </div>
    </header>

    {{!-- ═══════════════════════════════════════════════════════════════════
         STAT BAR: Key gear statistics
    ═══════════════════════════════════════════════════════════════════ --}}
    <div class="rt-gear-stats">
      <div class="rt-gear-stat rt-gear-stat--category">
        <div class="rt-gear-stat__icon">
          <i class="fas fa-tag"></i>
        </div>
        <div class="rt-gear-stat__content">
          <span class="rt-gear-stat__label">Category</span>
          <span class="rt-gear-stat__value">{{categoryLabel}}</span>
        </div>
      </div>
      
      <div class="rt-gear-stat rt-gear-stat--quantity">
        <div class="rt-gear-stat__icon">
          <i class="fas fa-cubes"></i>
        </div>
        <div class="rt-gear-stat__content">
          <span class="rt-gear-stat__label">Quantity</span>
          <span class="rt-gear-stat__value">{{system.quantity}}</span>
        </div>
      </div>
      
      <div class="rt-gear-stat rt-gear-stat--weight">
        <div class="rt-gear-stat__icon">
          <i class="fas fa-weight-hanging"></i>
        </div>
        <div class="rt-gear-stat__content">
          <span class="rt-gear-stat__label">Weight</span>
          <span class="rt-gear-stat__value">{{system.totalWeight}}kg</span>
        </div>
      </div>
    </div>

    {{!-- ═══════════════════════════════════════════════════════════════════
         TAB NAVIGATION
    ═══════════════════════════════════════════════════════════════════ --}}
    <nav class="rt-gear-tabs" data-group="primary">
      <button type="button" class="rt-gear-tab active" data-tab="details" data-group="primary">
        <i class="fas fa-circle-info"></i>
        <span>Details</span>
      </button>
      <button type="button" class="rt-gear-tab" data-tab="description" data-group="primary">
        <i class="fas fa-scroll"></i>
        <span>Info</span>
      </button>
      <button type="button" class="rt-gear-tab" data-tab="effects" data-group="primary">
        <i class="fas fa-magic"></i>
        <span>Effects</span>
      </button>
    </nav>

    {{!-- ═══════════════════════════════════════════════════════════════════
         TAB CONTENT
    ═══════════════════════════════════════════════════════════════════ --}}
    <section class="rt-gear-content">
      
      {{!-- DETAILS TAB --}}
      <div class="rt-gear-panel active" data-tab="details" data-group="primary">
        
        {{!-- Category & Classification --}}
        <div class="rt-gear-section">
          <div class="rt-gear-section__header">
            <i class="fas fa-tags"></i>
            <h3>Classification</h3>
          </div>
          <div class="rt-gear-section__body">
            <div class="rt-field">
              <label>Category</label>
              <select name="system.category">
                <option value="general" {{#if (eq system.category "general")}}selected{{/if}}>General Equipment</option>
                <option value="tools" {{#if (eq system.category "tools")}}selected{{/if}}>Tools</option>
                <option value="drugs" {{#if (eq system.category "drugs")}}selected{{/if}}>Drugs & Consumables</option>
                <option value="medical" {{#if (eq system.category "medical")}}selected{{/if}}>Medical Supplies</option>
                <option value="tech" {{#if (eq system.category "tech")}}selected{{/if}}>Tech & Electronics</option>
                <option value="clothing" {{#if (eq system.category "clothing")}}selected{{/if}}>Clothing</option>
                <option value="survival" {{#if (eq system.category "survival")}}selected{{/if}}>Survival Gear</option>
                <option value="religious" {{#if (eq system.category "religious")}}selected{{/if}}>Religious Items</option>
                <option value="luxury" {{#if (eq system.category "luxury")}}selected{{/if}}>Luxury Goods</option>
                <option value="documents" {{#if (eq system.category "documents")}}selected{{/if}}>Documents</option>
              </select>
            </div>
          </div>
        </div>

        {{!-- Physical Properties --}}
        <div class="rt-gear-section">
          <div class="rt-gear-section__header">
            <i class="fas fa-cubes"></i>
            <h3>Physical Properties</h3>
          </div>
          <div class="rt-gear-section__body">
            <div class="rt-field-row">
              <div class="rt-field">
                <label>Weight (kg)</label>
                <input type="number" name="system.weight" value="{{system.weight}}" 
                       data-dtype="Number" min="0" step="0.1" />
              </div>
              <div class="rt-field">
                <label>Quantity</label>
                <input type="number" name="system.quantity" value="{{system.quantity}}" 
                       data-dtype="Number" min="1" />
              </div>
            </div>
            <div class="rt-field-row">
              <div class="rt-field">
                <label>Availability</label>
                <select name="system.availability">
                  <option value="ubiquitous" {{#if (eq system.availability "ubiquitous")}}selected{{/if}}>Ubiquitous</option>
                  <option value="abundant" {{#if (eq system.availability "abundant")}}selected{{/if}}>Abundant</option>
                  <option value="plentiful" {{#if (eq system.availability "plentiful")}}selected{{/if}}>Plentiful</option>
                  <option value="common" {{#if (eq system.availability "common")}}selected{{/if}}>Common</option>
                  <option value="average" {{#if (eq system.availability "average")}}selected{{/if}}>Average</option>
                  <option value="scarce" {{#if (eq system.availability "scarce")}}selected{{/if}}>Scarce</option>
                  <option value="rare" {{#if (eq system.availability "rare")}}selected{{/if}}>Rare</option>
                  <option value="very-rare" {{#if (eq system.availability "very-rare")}}selected{{/if}}>Very Rare</option>
                  <option value="extremely-rare" {{#if (eq system.availability "extremely-rare")}}selected{{/if}}>Extremely Rare</option>
                  <option value="near-unique" {{#if (eq system.availability "near-unique")}}selected{{/if}}>Near Unique</option>
                  <option value="unique" {{#if (eq system.availability "unique")}}selected{{/if}}>Unique</option>
                </select>
              </div>
              <div class="rt-field">
                <label>Craftsmanship</label>
                <select name="system.craftsmanship">
                  <option value="poor" {{#if (eq system.craftsmanship "poor")}}selected{{/if}}>Poor</option>
                  <option value="common" {{#if (eq system.craftsmanship "common")}}selected{{/if}}>Common</option>
                  <option value="good" {{#if (eq system.craftsmanship "good")}}selected{{/if}}>Good</option>
                  <option value="best" {{#if (eq system.craftsmanship "best")}}selected{{/if}}>Best</option>
                </select>
              </div>
            </div>
            <div class="rt-field">
              <label>Cost (Thrones)</label>
              <input type="number" name="system.cost.value" value="{{system.cost.value}}" 
                     data-dtype="Number" min="0" />
            </div>
          </div>
        </div>

        {{!-- Storage Location --}}
        <div class="rt-gear-section">
          <div class="rt-gear-section__header">
            <i class="fas fa-box"></i>
            <h3>Storage</h3>
          </div>
          <div class="rt-gear-section__body">
            <div class="rt-field-row rt-field-row--checkboxes">
              <label class="rt-checkbox">
                <input type="checkbox" name="system.equipped" {{checked system.equipped}} />
                <span>Equipped</span>
              </label>
              <label class="rt-checkbox">
                <input type="checkbox" name="system.inBackpack" {{checked system.inBackpack}} />
                <span>In Backpack</span>
              </label>
            </div>
          </div>
        </div>

        {{!-- Consumable / Limited Uses --}}
        {{#if hasLimitedUses}}
        <div class="rt-gear-section rt-gear-section--consumable">
          <div class="rt-gear-section__header">
            <i class="fas fa-hourglass-half"></i>
            <h3>Consumable Properties</h3>
            <span class="rt-gear-section__badge {{#if usesExhausted}}rt-gear-section__badge--danger{{/if}}">
              {{usesDisplay}}
            </span>
          </div>
          <div class="rt-gear-section__body">
            <div class="rt-field-row">
              <div class="rt-field">
                <label>Current Uses</label>
                <input type="number" name="system.uses.value" value="{{system.uses.value}}" 
                       data-dtype="Number" min="0" />
              </div>
              <div class="rt-field">
                <label>Maximum Uses</label>
                <input type="number" name="system.uses.max" value="{{system.uses.max}}" 
                       data-dtype="Number" min="0" />
              </div>
            </div>
            <div class="rt-field">
              <label>Duration / Recovery</label>
              <input type="text" name="system.uses.duration" value="{{system.uses.duration}}" 
                     placeholder="1 hour, 1d6 rounds, etc." />
            </div>
            <div class="rt-consumable-actions">
              <button type="button" class="rt-btn rt-btn--secondary" data-action="consumeUse">
                <i class="fas fa-minus"></i>
                Use One
              </button>
              <button type="button" class="rt-btn rt-btn--primary" data-action="resetUses">
                <i class="fas fa-redo"></i>
                Reset Uses
              </button>
            </div>
          </div>
        </div>
        {{/if}}

      </div>

      {{!-- DESCRIPTION TAB --}}
      <div class="rt-gear-panel" data-tab="description" data-group="primary">
        
        {{!-- Effect --}}
        <div class="rt-gear-section">
          <div class="rt-gear-section__header">
            <i class="fas fa-bolt"></i>
            <h3>Mechanical Effect</h3>
          </div>
          <div class="rt-gear-section__body rt-gear-section__body--editor">
            {{editor system.effect target="system.effect" button=true editable=editable engine="prosemirror"}}
          </div>
        </div>

        {{!-- Description --}}
        <div class="rt-gear-section">
          <div class="rt-gear-section__header">
            <i class="fas fa-book"></i>
            <h3>Description</h3>
          </div>
          <div class="rt-gear-section__body rt-gear-section__body--editor">
            {{editor system.description target="system.description" button=true editable=editable engine="prosemirror"}}
          </div>
        </div>

        {{!-- Notes --}}
        <div class="rt-gear-section">
          <div class="rt-gear-section__header">
            <i class="fas fa-sticky-note"></i>
            <h3>Notes</h3>
          </div>
          <div class="rt-gear-section__body">
            <textarea name="system.notes" rows="4" placeholder="GM notes, special rules, etc.">{{system.notes}}</textarea>
          </div>
        </div>

        {{!-- Source --}}
        <div class="rt-gear-section">
          <div class="rt-gear-section__header">
            <i class="fas fa-book-open"></i>
            <h3>Source</h3>
          </div>
          <div class="rt-gear-section__body">
            <input type="text" name="system.source" value="{{system.source}}" 
                   placeholder="Rogue Trader Core Rulebook, pg. 123" />
          </div>
        </div>

      </div>

      {{!-- EFFECTS TAB --}}
      <div class="rt-gear-panel" data-tab="effects" data-group="primary">
        {{> systems/rogue-trader/templates/item/panel/active-effects-panel.hbs}}
      </div>

    </section>

  </form>
</div>
