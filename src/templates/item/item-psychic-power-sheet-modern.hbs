<div class="rt-item-sheet">
    <form autocomplete="off">
        <!-- Item Header -->
        <header class="rt-item-header">
            <div class="rt-item-image" data-edit="img">
                <img src="{{item.img}}" alt="{{item.name}}" title="{{item.name}}" />
            </div>
            
            <div class="rt-item-title">
                <input type="text" class="rt-item-title__name" name="name" value="{{item.name}}" placeholder="Psychic Power Name" />
                <div class="rt-item-title__type">
                    <i class="fas fa-brain"></i>
                    <span>{{item.system.discipline}} Power</span>
                </div>
                <div class="rt-item-meta">
                    {{#if item.system.subtype}}
                    <span class="rt-meta-badge rt-meta-badge--psychic">
                        <i class="fas fa-tags"></i> {{item.system.subtype}}
                    </span>
                    {{/if}}
                    {{#if item.system.source}}
                    <span class="rt-meta-badge rt-meta-badge--source">
                        <i class="fas fa-book"></i> {{item.system.source}}
                    </span>
                    {{/if}}
                </div>
            </div>
        </header>

        <!-- Quick Stats Bar -->
        <div class="rt-quick-stats">
            {{#if item.system.action}}
            <div class="rt-stat-badge rt-stat-badge--psychic">
                <span class="rt-stat-badge__icon"><i class="fas fa-bolt"></i></span>
                <span class="rt-stat-badge__label">ACTION</span>
                <span class="rt-stat-badge__value">{{item.system.action}}</span>
            </div>
            {{/if}}
            
            {{#if item.system.range}}
            <div class="rt-stat-badge">
                <span class="rt-stat-badge__icon"><i class="fas fa-arrows-left-right"></i></span>
                <span class="rt-stat-badge__label">RANGE</span>
                <span class="rt-stat-badge__value">{{item.system.range}}</span>
            </div>
            {{/if}}
            
            {{#if item.system.sustained}}
            <div class="rt-stat-badge">
                <span class="rt-stat-badge__icon"><i class="fas fa-clock"></i></span>
                <span class="rt-stat-badge__label">SUSTAINED</span>
                <span class="rt-stat-badge__value">{{item.system.sustained}}</span>
            </div>
            {{/if}}
            
            {{#if item.system.subtype}}
            <div class="rt-stat-badge">
                <span class="rt-stat-badge__icon"><i class="fas fa-tags"></i></span>
                <span class="rt-stat-badge__label">TYPE</span>
                <span class="rt-stat-badge__value">{{item.system.subtype}}</span>
            </div>
            {{/if}}
            
            {{#if item.system.cost}}
            <div class="rt-stat-badge">
                <span class="rt-stat-badge__icon"><i class="fas fa-gem"></i></span>
                <span class="rt-stat-badge__label">XP</span>
                <span class="rt-stat-badge__value">{{item.system.cost}}</span>
            </div>
            {{/if}}
        </div>

        <!-- Tab Navigation -->
        <nav class="rt-tabs" data-group="primary">
            <a class="rt-tab active" data-tab="power" data-group="primary">
                <i class="fas fa-hand-sparkles"></i> Power
            </a>
            <a class="rt-tab" data-tab="damage" data-group="primary">
                <i class="fas fa-burst"></i> Damage
            </a>
            <a class="rt-tab" data-tab="description" data-group="primary">
                <i class="fas fa-scroll"></i> Description
            </a>
            <a class="rt-tab" data-tab="effects" data-group="primary">
                <i class="fas fa-magic"></i> Effects
            </a>
        </nav>

        <!-- Tab Content -->
        <section class="rt-tab-content">
            <!-- Power Tab -->
            <div class="tab active" data-tab="power" data-group="primary">
                <div class="rt-panel">
                    <div class="rt-panel__header">
                        <h3><i class="fas fa-brain"></i> Power Details</h3>
                    </div>
                    <div class="rt-panel__content">
                        <div class="rt-field-grid rt-field-grid--3">
                            <div class="rt-field">
                                <label class="rt-field__label">Discipline</label>
                                <input type="text" class="rt-field__input" name="system.discipline" value="{{item.system.discipline}}" placeholder="e.g., Telepathy" />
                            </div>
                            <div class="rt-field">
                                <label class="rt-field__label">XP Cost</label>
                                <input type="number" class="rt-field__input" name="system.cost" value="{{item.system.cost}}" />
                            </div>
                            <div class="rt-field">
                                <label class="rt-field__label">Source</label>
                                <input type="text" class="rt-field__input" name="system.source" value="{{item.system.source}}" />
                            </div>
                        </div>
                        
                        <div class="rt-field-grid rt-field-grid--3" style="margin-top: 1rem;">
                            <div class="rt-field">
                                <label class="rt-field__label">Action</label>
                                <select class="rt-field__select" name="system.action">
                                    {{selectOptions (arrayToObject dh.combat.action_speeds) selected=item.system.action}}
                                </select>
                            </div>
                            <div class="rt-field">
                                <label class="rt-field__label">Sustained</label>
                                <select class="rt-field__select" name="system.sustained">
                                    {{selectOptions (arrayToObject dh.combat.sustained_speeds) selected=item.system.sustained}}
                                </select>
                            </div>
                            <div class="rt-field">
                                <label class="rt-field__label">Subtype</label>
                                <select class="rt-field__select" name="system.subtype">
                                    {{selectOptions (arrayToObject dh.combat.psychic_subtypes) selected=item.system.subtype}}
                                </select>
                            </div>
                        </div>
                        
                        <div class="rt-field-grid rt-field-grid--2" style="margin-top: 1rem;">
                            <div class="rt-field">
                                <label class="rt-field__label">Range</label>
                                <input type="text" class="rt-field__input" name="system.range" value="{{item.system.range}}" placeholder="e.g., 10m x PR" />
                            </div>
                            <div class="rt-field">
                                <label class="rt-field__label">Prerequisites</label>
                                <input type="text" class="rt-field__input" name="system.prerequisites" value="{{item.system.prerequisites}}" />
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="rt-panel">
                    <div class="rt-panel__header">
                        <h3><i class="fas fa-crosshairs"></i> Focus Test</h3>
                    </div>
                    <div class="rt-panel__content">
                        <div class="rt-field-grid rt-field-grid--3">
                            <div class="rt-field">
                                <label class="rt-field__label">Bonus</label>
                                <input type="text" class="rt-field__input" name="system.target.bonus" value="{{item.system.target.bonus}}" placeholder="+0" />
                            </div>
                            <div class="rt-field">
                                <label class="rt-field__label">Use Skill</label>
                                <div style="padding-top: 0.5rem;">
                                    <input type="checkbox" name="system.target.useSkill" {{checked item.system.target.useSkill}} />
                                </div>
                            </div>
                            {{#if item.system.target.useSkill}}
                            <div class="rt-field">
                                <label class="rt-field__label">Skill</label>
                                <input type="text" class="rt-field__input" name="system.target.skill" value="{{item.system.target.skill}}" />
                            </div>
                            {{else}}
                            <div class="rt-field">
                                <label class="rt-field__label">Characteristic</label>
                                <select class="rt-field__select" name="system.target.characteristic">
                                    {{selectOptions dh.combat.characteristics selected=item.system.target.characteristic}}
                                </select>
                            </div>
                            {{/if}}
                        </div>
                        
                        <div class="rt-field-grid rt-field-grid--3" style="margin-top: 1rem;">
                            <div class="rt-field">
                                <label class="rt-field__label">Is Opposed</label>
                                <div style="padding-top: 0.5rem;">
                                    <input type="checkbox" name="system.target.isOpposed" {{checked item.system.target.isOpposed}} />
                                </div>
                            </div>
                            <div class="rt-field">
                                <label class="rt-field__label">Use Opposed Skill</label>
                                <div style="padding-top: 0.5rem;">
                                    <input type="checkbox" name="system.target.useOpposedSkill" {{checked item.system.target.useOpposedSkill}} />
                                </div>
                            </div>
                            {{#if item.system.target.useOpposedSkill}}
                            <div class="rt-field">
                                <label class="rt-field__label">Opposed Skill</label>
                                <input type="text" class="rt-field__input" name="system.target.opposedSkill" value="{{item.system.target.opposedSkill}}" />
                            </div>
                            {{else}}
                            <div class="rt-field">
                                <label class="rt-field__label">Opposed Characteristic</label>
                                <select class="rt-field__select" name="system.target.opposed">
                                    {{selectOptions dh.combat.characteristics selected=item.system.target.opposed}}
                                </select>
                            </div>
                            {{/if}}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Damage Tab -->
            <div class="tab" data-tab="damage" data-group="primary">
                <div class="rt-panel">
                    <div class="rt-panel__header">
                        <h3><i class="fas fa-burst"></i> Damage</h3>
                    </div>
                    <div class="rt-panel__content">
                        <div class="rt-field-grid rt-field-grid--4">
                            <div class="rt-field">
                                <label class="rt-field__label">Attack Type</label>
                                <select class="rt-field__select" name="system.attackType">
                                    {{selectOptions (arrayToObject dh.combat.psychic_attacks) selected=item.system.attackType}}
                                </select>
                            </div>
                            <div class="rt-field">
                                <label class="rt-field__label">Damage</label>
                                <input type="text" class="rt-field__input" name="system.damage" value="{{item.system.damage}}" placeholder="e.g., 1d10+PR" />
                            </div>
                            <div class="rt-field">
                                <label class="rt-field__label">Type</label>
                                <select class="rt-field__select" name="system.damageType">
                                    {{selectOptions (arrayToObject dh.combat.damage_types) selected=item.system.damageType}}
                                </select>
                            </div>
                            <div class="rt-field">
                                <label class="rt-field__label">Penetration</label>
                                <input type="text" class="rt-field__input" name="system.penetration" value="{{item.system.penetration}}" placeholder="0" />
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="rt-panel">
                    <div class="rt-panel__header">
                        <h3><i class="fas fa-star"></i> Attack Specials</h3>
                        <div class="rt-panel__actions">
                            <button type="button" class="rt-btn rt-btn--primary add-quality">
                                <i class="fas fa-plus"></i> Add Special
                            </button>
                        </div>
                    </div>
                    <div class="rt-panel__content">
                        <div class="rt-tags">
                            {{#each item.items as |embedded|}}
                            {{#if embedded.isAttackSpecial}}
                            <span class="rt-tag rt-tag--psychic" data-item-id="{{embedded.id}}">
                                {{embedded.name}}
                                {{#if embedded.system.level}}({{embedded.system.level}}){{/if}}
                                <i class="fas fa-times item-delete" data-item-id="{{embedded.id}}" style="cursor: pointer; margin-left: 4px;"></i>
                            </span>
                            {{/if}}
                            {{/each}}
                        </div>
                        
                        {{#unless item.items.length}}
                        <p class="rt-empty-state">No attack specials. Drag attack specials here to add them.</p>
                        {{/unless}}
                    </div>
                </div>
            </div>

            <!-- Description Tab -->
            <div class="tab" data-tab="description" data-group="primary">
                <div class="rt-panel">
                    <div class="rt-panel__header">
                        <h3><i class="fas fa-scroll"></i> Description</h3>
                    </div>
                    <div class="rt-panel__content">
                        <div class="rt-description">
                            {{#if inEditMode}}
                              {{editor content=system.description.value target="system.description.value" button=true editable=true engine="prosemirror"}}
                            {{else}}
                              <div class="rt-description-content">{{{system.description.value}}}</div>
                            {{/if}}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Effects Tab -->
            <div class="tab" data-tab="effects" data-group="primary">
                {{> systems/rogue-trader/templates/item/panel/active-effects-panel.hbs}}
            </div>
        </section>
    </form>
</div>
