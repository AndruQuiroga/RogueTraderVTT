<div class="rt-item-sheet">
    <form autocomplete="off">
        <!-- Item Header -->
        <header class="rt-item-header">
            <div class="rt-item-image" data-edit="img">
                <img src="{{item.img}}" alt="{{item.name}}" title="{{item.name}}" />
            </div>
            
            <div class="rt-item-title">
                <input type="text" class="rt-item-title__name" name="name" value="{{item.name}}" placeholder="Armour Name" />
                <div class="rt-item-title__type">
                    <i class="fas fa-shield-halved"></i>
                    <span>{{item.system.type}} Armour</span>
                </div>
                <div class="rt-item-meta">
                    {{#if item.system.type}}
                    <span class="rt-meta-badge rt-meta-badge--type">
                        <i class="fas fa-shield"></i> {{item.system.type}}
                    </span>
                    {{/if}}
                    {{#if item.system.craftsmanship}}
                    <span class="rt-meta-badge rt-meta-badge--craft">
                        <i class="fas fa-hammer"></i> {{item.system.craftsmanship}}
                    </span>
                    {{/if}}
                    {{#if item.system.availability}}
                    <span class="rt-meta-badge rt-meta-badge--availability">
                        <i class="fas fa-store"></i> {{item.system.availability}}
                    </span>
                    {{/if}}
                    {{#if item.system.source}}
                    <span class="rt-meta-badge rt-meta-badge--source">
                        <i class="fas fa-book"></i> {{item.system.source}}
                    </span>
                    {{/if}}
                </div>
            </div>
        </header>

        <!-- Quick Stats Bar -->
        <div class="rt-quick-stats">
            <div class="rt-stat-badge rt-stat-badge--primary">
                <span class="rt-stat-badge__icon"><i class="fas fa-head-side"></i></span>
                <span class="rt-stat-badge__label">HEAD</span>
                <span class="rt-stat-badge__value">{{item.system.armourPoints.head}}</span>
            </div>
            
            <div class="rt-stat-badge">
                <span class="rt-stat-badge__icon"><i class="fas fa-person"></i></span>
                <span class="rt-stat-badge__label">BODY</span>
                <span class="rt-stat-badge__value">{{item.system.armourPoints.body}}</span>
            </div>
            
            <div class="rt-stat-badge">
                <span class="rt-stat-badge__icon"><i class="fas fa-hand"></i></span>
                <span class="rt-stat-badge__label">L.ARM</span>
                <span class="rt-stat-badge__value">{{item.system.armourPoints.leftArm}}</span>
            </div>
            
            <div class="rt-stat-badge">
                <span class="rt-stat-badge__icon"><i class="fas fa-hand"></i></span>
                <span class="rt-stat-badge__label">R.ARM</span>
                <span class="rt-stat-badge__value">{{item.system.armourPoints.rightArm}}</span>
            </div>
            
            <div class="rt-stat-badge">
                <span class="rt-stat-badge__icon"><i class="fas fa-socks"></i></span>
                <span class="rt-stat-badge__label">L.LEG</span>
                <span class="rt-stat-badge__value">{{item.system.armourPoints.leftLeg}}</span>
            </div>
            
            <div class="rt-stat-badge">
                <span class="rt-stat-badge__icon"><i class="fas fa-socks"></i></span>
                <span class="rt-stat-badge__label">R.LEG</span>
                <span class="rt-stat-badge__value">{{item.system.armourPoints.rightLeg}}</span>
            </div>
            
            {{#if item.system.equipped}}
            <div class="rt-stat-badge rt-stat-badge--equipped">
                <span class="rt-stat-badge__icon"><i class="fas fa-check"></i></span>
                <span class="rt-stat-badge__value">WORN</span>
            </div>
            {{/if}}
        </div>

        <!-- Tab Navigation -->
        <nav class="rt-tabs" data-group="primary">
            <a class="rt-tab active" data-tab="protection" data-group="primary">
                <i class="fas fa-shield"></i> Protection
            </a>
            <a class="rt-tab" data-tab="mods" data-group="primary">
                <i class="fas fa-wrench"></i> Modifications
            </a>
            <a class="rt-tab" data-tab="description" data-group="primary">
                <i class="fas fa-scroll"></i> Description
            </a>
            <a class="rt-tab" data-tab="effects" data-group="primary">
                <i class="fas fa-magic"></i> Effects
            </a>
        </nav>

        <!-- Tab Content -->
        <section class="rt-tab-content">
            <!-- Protection Tab -->
            <div class="tab active" data-tab="protection" data-group="primary">
                <div class="rt-panel">
                    <div class="rt-panel__header">
                        <h3><i class="fas fa-shield-halved"></i> Armour Points by Location</h3>
                    </div>
                    <div class="rt-panel__content">
                        <div class="rt-armour-diagram">
                            <div class="rt-field-grid rt-field-grid--3">
                                <div class="rt-field">
                                    <label class="rt-field__label">Head</label>
                                    <input type="text" class="rt-field__input rt-field__input--centered" name="system.armourPoints.head" value="{{item.system.armourPoints.head}}" />
                                </div>
                                <div class="rt-field">
                                    <label class="rt-field__label">Body</label>
                                    <input type="text" class="rt-field__input rt-field__input--centered" name="system.armourPoints.body" value="{{item.system.armourPoints.body}}" />
                                </div>
                                <div class="rt-field">
                                    <label class="rt-field__label">Max Agility</label>
                                    <input type="text" class="rt-field__input rt-field__input--centered" name="system.maxAgility" value="{{item.system.maxAgility}}" placeholder="â€”" />
                                </div>
                            </div>
                            
                            <div class="rt-field-grid rt-field-grid--4" style="margin-top: 1rem;">
                                <div class="rt-field">
                                    <label class="rt-field__label">Left Arm</label>
                                    <input type="text" class="rt-field__input rt-field__input--centered" name="system.armourPoints.leftArm" value="{{item.system.armourPoints.leftArm}}" />
                                </div>
                                <div class="rt-field">
                                    <label class="rt-field__label">Right Arm</label>
                                    <input type="text" class="rt-field__input rt-field__input--centered" name="system.armourPoints.rightArm" value="{{item.system.armourPoints.rightArm}}" />
                                </div>
                                <div class="rt-field">
                                    <label class="rt-field__label">Left Leg</label>
                                    <input type="text" class="rt-field__input rt-field__input--centered" name="system.armourPoints.leftLeg" value="{{item.system.armourPoints.leftLeg}}" />
                                </div>
                                <div class="rt-field">
                                    <label class="rt-field__label">Right Leg</label>
                                    <input type="text" class="rt-field__input rt-field__input--centered" name="system.armourPoints.rightLeg" value="{{item.system.armourPoints.rightLeg}}" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="rt-panel">
                    <div class="rt-panel__header">
                        <h3><i class="fas fa-coins"></i> Acquisition</h3>
                    </div>
                    <div class="rt-panel__content">
                        <div class="rt-field-grid rt-field-grid--4">
                            <div class="rt-field">
                                <label class="rt-field__label">Type</label>
                                <select class="rt-field__select" name="system.type">
                                    {{selectOptions (arrayToObject dh.combat.armour_type) selected=item.system.type}}
                                </select>
                            </div>
                            <div class="rt-field">
                                <label class="rt-field__label">Availability</label>
                                <select class="rt-field__select" name="system.availability">
                                    {{selectOptions (arrayToObject dh.items.availability) selected=item.system.availability}}
                                </select>
                            </div>
                            <div class="rt-field">
                                <label class="rt-field__label">Craftsmanship</label>
                                <select class="rt-field__select" name="system.craftsmanship">
                                    {{selectOptions (arrayToObject dh.items.craftsmanship) selected=item.system.craftsmanship}}
                                </select>
                            </div>
                            <div class="rt-field">
                                <label class="rt-field__label">Weight (kg)</label>
                                <input type="number" class="rt-field__input" name="system.weight" value="{{item.system.weight}}" step="0.1" />
                            </div>
                        </div>
                        
                        <div class="rt-field-grid rt-field-grid--2" style="margin-top: 1rem;">
                            <div class="rt-field">
                                <label class="rt-field__label">Source</label>
                                <input type="text" class="rt-field__input" name="system.source" value="{{item.system.source}}" />
                            </div>
                            <div style="display: flex; gap: 2rem; align-items: center; padding-top: 1.5rem;">
                                <label class="rt-field__checkbox">
                                    <input type="checkbox" name="system.equipped" {{checked item.system.equipped}} />
                                    <span>Equipped</span>
                                </label>
                                <label class="rt-field__checkbox">
                                    <input type="checkbox" name="system.backpack.inBackpack" {{checked item.system.backpack.inBackpack}} />
                                    <span>In Backpack</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modifications Tab -->
            <div class="tab" data-tab="mods" data-group="primary">
                <div class="rt-panel">
                    <div class="rt-panel__header">
                        <h3><i class="fas fa-wrench"></i> Armour Modifications</h3>
                        <div class="rt-panel__actions">
                            <button type="button" class="rt-btn rt-btn--primary add-modification">
                                <i class="fas fa-plus"></i> Add Modification
                            </button>
                        </div>
                    </div>
                    <div class="rt-panel__content">
                        {{#each item.items as |embedded|}}
                        {{#if embedded.isArmourModification}}
                        <div class="rt-mod-row">
                            <div class="rt-mod-row__info">
                                <button type="button" class="rt-btn rt-btn--icon-only item-edit" data-item-id="{{embedded.id}}">
                                    <i class="fas fa-cog"></i>
                                </button>
                                <strong>{{embedded.name}}</strong>
                                <span class="rt-mod-row__detail">{{embedded.system.craftsmanship}}</span>
                                {{#if embedded.system.equipped}}
                                <span class="rt-tag rt-tag--success">Installed</span>
                                {{else}}
                                <span class="rt-tag rt-tag--muted">Not Installed</span>
                                {{/if}}
                            </div>
                            <button type="button" class="rt-btn rt-btn--icon-only rt-btn--danger item-delete" data-item-id="{{embedded.id}}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        {{/if}}
                        {{/each}}
                        
                        {{#unless item.items.length}}
                        <p class="rt-empty-state">No modifications installed. Drag armour mods here to add them.</p>
                        {{/unless}}
                    </div>
                </div>
            </div>

            <!-- Description Tab -->
            <div class="tab" data-tab="description" data-group="primary">
                <div class="rt-panel">
                    <div class="rt-panel__header">
                        <h3><i class="fas fa-scroll"></i> Description</h3>
                    </div>
                    <div class="rt-panel__content">
                        <div class="rt-description">
                            {{editor item.system.description.value target="system.description.value" button=true editable=true engine="prosemirror"}}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Effects Tab -->
            <div class="tab" data-tab="effects" data-group="primary">
                {{> systems/rogue-trader/templates/item/panel/active-effects-panel.hbs}}
            </div>
        </section>
    </form>
</div>
