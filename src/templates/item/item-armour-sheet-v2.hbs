{{!-- 
  Rogue Trader Armour Item Sheet - V2 Complete Redesign
  Matches weapon sheet pattern with modern ApplicationV2 structure
--}}
<div class="rt-armour-sheet">
  <form autocomplete="off">
    
    {{!-- ═══════════════════════════════════════════════════════════════════
         HEADER: Compact armour identity with inline stats
    ═══════════════════════════════════════════════════════════════════ --}}
    <header class="rt-armour-header">
      <div class="rt-armour-header__image" data-action="editImage" data-edit="img">
        <img src="{{item.img}}" alt="{{item.name}}" />
        <div class="rt-armour-header__image-overlay">
          <i class="fas fa-edit"></i>
        </div>
      </div>
      
      <div class="rt-armour-header__info">
        <input type="text" class="rt-armour-header__name" name="name" value="{{item.name}}" placeholder="Armour Name" />
        
        <div class="rt-armour-header__meta">
          <span class="rt-armour-badge rt-armour-badge--type rt-armour-badge--{{item.system.type}}" title="Armour Type">
            <i class="fas {{item.system.typeIcon}}"></i>
            {{item.system.typeLabel}}
          </span>
          <span class="rt-armour-badge rt-armour-badge--protection rt-armour-badge--{{item.system.protectionLevel}}" title="Maximum Armour Points">
            AP {{item.system.maxAP}}
          </span>
          {{#if (ne item.system.craftsmanship "common")}}
          <span class="rt-armour-badge rt-armour-badge--craft rt-armour-badge--{{item.system.craftsmanship}}" title="Craftsmanship">
            <i class="fas fa-hammer"></i>
            {{item.system.craftsmanshipLabel}}
          </span>
          {{/if}}
          {{#if item.system.maxAgility}}
          <span class="rt-armour-badge rt-armour-badge--agility" title="Maximum Agility Bonus">
            <i class="fas fa-person-running"></i>
            Max Ag {{item.system.maxAgility}}
          </span>
          {{/if}}
        </div>
      </div>
      
      <div class="rt-armour-header__equipped">
        <label class="rt-toggle-equipped" title="Toggle Equipped">
          <input type="checkbox" name="system.equipped" {{checked item.system.equipped}} />
          <span class="rt-toggle-equipped__indicator">
            <i class="fas {{#if item.system.equipped}}fa-check-circle{{else}}fa-circle{{/if}}"></i>
          </span>
          <span class="rt-toggle-equipped__label">{{#if item.system.equipped}}Worn{{else}}Stowed{{/if}}</span>
        </label>
      </div>
    </header>

    {{!-- ═══════════════════════════════════════════════════════════════════
         STATS BAR: Primary armour stats at a glance
    ═══════════════════════════════════════════════════════════════════ --}}
    <div class="rt-armour-stats">
      {{!-- Max AP --}}
      <div class="rt-armour-stat rt-armour-stat--ap">
        <div class="rt-armour-stat__icon">
          <i class="fas fa-shield-halved"></i>
        </div>
        <div class="rt-armour-stat__content">
          <span class="rt-armour-stat__label">Max AP</span>
          <span class="rt-armour-stat__value">{{system.maxAP}}</span>
        </div>
      </div>
      
      {{!-- Weight --}}
      <div class="rt-armour-stat rt-armour-stat--weight">
        <div class="rt-armour-stat__icon">
          <i class="fas fa-weight-hanging"></i>
        </div>
        <div class="rt-armour-stat__content">
          <span class="rt-armour-stat__label">Weight</span>
          <span class="rt-armour-stat__value">{{system.weight}}kg</span>
        </div>
      </div>
      
      {{!-- Coverage --}}
      <div class="rt-armour-stat rt-armour-stat--coverage">
        <div class="rt-armour-stat__icon">
          <i class="fas fa-person"></i>
        </div>
        <div class="rt-armour-stat__content">
          <span class="rt-armour-stat__label">Coverage</span>
          <span class="rt-armour-stat__value">{{system.locationCount}}/6</span>
        </div>
      </div>
      
      {{!-- Max Agility (if limited) --}}
      {{#if system.maxAgility}}
      <div class="rt-armour-stat rt-armour-stat--agility">
        <div class="rt-armour-stat__icon">
          <i class="fas fa-person-running"></i>
        </div>
        <div class="rt-armour-stat__content">
          <span class="rt-armour-stat__label">Max Ag</span>
          <span class="rt-armour-stat__value">{{system.maxAgility}}</span>
        </div>
      </div>
      {{/if}}
      
      {{!-- Head AP --}}
      <div class="rt-armour-stat rt-armour-stat--location">
        <div class="rt-armour-stat__icon">
          <i class="fas fa-head-side-brain"></i>
        </div>
        <div class="rt-armour-stat__content">
          <span class="rt-armour-stat__label">Head</span>
          <span class="rt-armour-stat__value">{{system.armourPoints.head}}</span>
        </div>
      </div>
      
      {{!-- Body AP --}}
      <div class="rt-armour-stat rt-armour-stat--location">
        <div class="rt-armour-stat__icon">
          <i class="fas fa-shield"></i>
        </div>
        <div class="rt-armour-stat__content">
          <span class="rt-armour-stat__label">Body</span>
          <span class="rt-armour-stat__value">{{system.armourPoints.body}}</span>
        </div>
      </div>
      
      {{!-- Arms AP (average) --}}
      <div class="rt-armour-stat rt-armour-stat--location">
        <div class="rt-armour-stat__icon">
          <i class="fas fa-hand-fist"></i>
        </div>
        <div class="rt-armour-stat__content">
          <span class="rt-armour-stat__label">Arms</span>
          <span class="rt-armour-stat__value">{{system.armourPoints.leftArm}}/{{system.armourPoints.rightArm}}</span>
        </div>
      </div>
      
      {{!-- Legs AP (average) --}}
      <div class="rt-armour-stat rt-armour-stat--location">
        <div class="rt-armour-stat__icon">
          <i class="fas fa-boot"></i>
        </div>
        <div class="rt-armour-stat__content">
          <span class="rt-armour-stat__label">Legs</span>
          <span class="rt-armour-stat__value">{{system.armourPoints.leftLeg}}/{{system.armourPoints.rightLeg}}</span>
        </div>
      </div>
    </div>

    {{!-- ═══════════════════════════════════════════════════════════════════
         TAB NAVIGATION
    ═══════════════════════════════════════════════════════════════════ --}}
    <nav class="rt-armour-tabs" data-group="primary">
      <button type="button" class="rt-armour-tab active" data-tab="protection" data-group="primary">
        <i class="fas fa-shield-halved"></i>
        <span>Protection</span>
      </button>
      <button type="button" class="rt-armour-tab" data-tab="properties" data-group="primary">
        <i class="fas fa-star"></i>
        <span>Properties</span>
      </button>
      <button type="button" class="rt-armour-tab" data-tab="mods" data-group="primary">
        <i class="fas fa-wrench"></i>
        <span>Mods</span>
      </button>
      <button type="button" class="rt-armour-tab" data-tab="description" data-group="primary">
        <i class="fas fa-book"></i>
        <span>Description</span>
      </button>
      <button type="button" class="rt-armour-tab" data-tab="effects" data-group="primary">
        <i class="fas fa-magic"></i>
        <span>Effects</span>
      </button>
    </nav>

    {{!-- ═══════════════════════════════════════════════════════════════════
         TAB CONTENT
    ═══════════════════════════════════════════════════════════════════ --}}
    <div class="rt-armour-content scrollable">
      
      {{!-- PROTECTION TAB --}}
      <div class="rt-armour-panel active" data-tab="protection" data-group="primary">
        
        {{!-- Armour Points Grid --}}
        <div class="rt-armour-section">
          <div class="rt-armour-section__header">
            <i class="fas fa-shield-halved"></i>
            <h3>Armour Points by Location</h3>
          </div>
          <div class="rt-armour-section__body">
            <div class="rt-armour-ap-grid">
              <div class="rt-armour-ap-field">
                <label><i class="fas fa-head-side-brain"></i> Head</label>
                <input type="number" name="system.armourPoints.head" value="{{item.system.armourPoints.head}}" 
                       data-dtype="Number" min="0" />
              </div>
              <div class="rt-armour-ap-field">
                <label><i class="fas fa-shield"></i> Body</label>
                <input type="number" name="system.armourPoints.body" value="{{item.system.armourPoints.body}}" 
                       data-dtype="Number" min="0" />
              </div>
              <div class="rt-armour-ap-field">
                <label><i class="fas fa-hand-fist"></i> L. Arm</label>
                <input type="number" name="system.armourPoints.leftArm" value="{{item.system.armourPoints.leftArm}}" 
                       data-dtype="Number" min="0" />
              </div>
              <div class="rt-armour-ap-field">
                <label><i class="fas fa-hand-fist"></i> R. Arm</label>
                <input type="number" name="system.armourPoints.rightArm" value="{{item.system.armourPoints.rightArm}}" 
                       data-dtype="Number" min="0" />
              </div>
              <div class="rt-armour-ap-field">
                <label><i class="fas fa-boot"></i> L. Leg</label>
                <input type="number" name="system.armourPoints.leftLeg" value="{{item.system.armourPoints.leftLeg}}" 
                       data-dtype="Number" min="0" />
              </div>
              <div class="rt-armour-ap-field">
                <label><i class="fas fa-boot"></i> R. Leg</label>
                <input type="number" name="system.armourPoints.rightLeg" value="{{item.system.armourPoints.rightLeg}}" 
                       data-dtype="Number" min="0" />
              </div>
            </div>
          </div>
        </div>

        {{!-- Base Properties --}}
        <div class="rt-armour-section">
          <div class="rt-armour-section__header">
            <i class="fas fa-cog"></i>
            <h3>Base Properties</h3>
          </div>
          <div class="rt-armour-section__body">
            <div class="rt-field-grid rt-field-grid--2col">
              <div class="rt-field">
                <label>Armour Type</label>
                <select name="system.type">
                  <option value="flak" {{#if (eq item.system.type "flak")}}selected{{/if}}>Flak</option>
                  <option value="mesh" {{#if (eq item.system.type "mesh")}}selected{{/if}}>Mesh</option>
                  <option value="carapace" {{#if (eq item.system.type "carapace")}}selected{{/if}}>Carapace</option>
                  <option value="power" {{#if (eq item.system.type "power")}}selected{{/if}}>Power Armour</option>
                  <option value="light-power" {{#if (eq item.system.type "light-power")}}selected{{/if}}>Light Power</option>
                  <option value="storm-trooper" {{#if (eq item.system.type "storm-trooper")}}selected{{/if}}>Storm Trooper</option>
                  <option value="feudal-world" {{#if (eq item.system.type "feudal-world")}}selected{{/if}}>Feudal World</option>
                  <option value="primitive" {{#if (eq item.system.type "primitive")}}selected{{/if}}>Primitive</option>
                  <option value="xenos" {{#if (eq item.system.type "xenos")}}selected{{/if}}>Xenos</option>
                  <option value="void" {{#if (eq item.system.type "void")}}selected{{/if}}>Void Suit</option>
                  <option value="enforcer" {{#if (eq item.system.type "enforcer")}}selected{{/if}}>Enforcer</option>
                  <option value="hostile-environment" {{#if (eq item.system.type "hostile-environment")}}selected{{/if}}>Hostile Environment</option>
                </select>
              </div>
              <div class="rt-field">
                <label>Max Agility Bonus <small>(leave blank if no limit)</small></label>
                <input type="number" name="system.maxAgility" value="{{item.system.maxAgility}}" 
                       data-dtype="Number" min="0" placeholder="No limit" />
              </div>
              <div class="rt-field">
                <label>Availability</label>
                <select name="system.availability">
                  <option value="ubiquitous" {{#if (eq item.system.availability "ubiquitous")}}selected{{/if}}>Ubiquitous</option>
                  <option value="abundant" {{#if (eq item.system.availability "abundant")}}selected{{/if}}>Abundant</option>
                  <option value="plentiful" {{#if (eq item.system.availability "plentiful")}}selected{{/if}}>Plentiful</option>
                  <option value="common" {{#if (eq item.system.availability "common")}}selected{{/if}}>Common</option>
                  <option value="average" {{#if (eq item.system.availability "average")}}selected{{/if}}>Average</option>
                  <option value="scarce" {{#if (eq item.system.availability "scarce")}}selected{{/if}}>Scarce</option>
                  <option value="rare" {{#if (eq item.system.availability "rare")}}selected{{/if}}>Rare</option>
                  <option value="very-rare" {{#if (eq item.system.availability "very-rare")}}selected{{/if}}>Very Rare</option>
                  <option value="extremely-rare" {{#if (eq item.system.availability "extremely-rare")}}selected{{/if}}>Extremely Rare</option>
                  <option value="near-unique" {{#if (eq item.system.availability "near-unique")}}selected{{/if}}>Near Unique</option>
                  <option value="unique" {{#if (eq item.system.availability "unique")}}selected{{/if}}>Unique</option>
                </select>
              </div>
              <div class="rt-field">
                <label>Craftsmanship</label>
                <select name="system.craftsmanship">
                  <option value="poor" {{#if (eq item.system.craftsmanship "poor")}}selected{{/if}}>Poor</option>
                  <option value="common" {{#if (eq item.system.craftsmanship "common")}}selected{{/if}}>Common</option>
                  <option value="good" {{#if (eq item.system.craftsmanship "good")}}selected{{/if}}>Good</option>
                  <option value="best" {{#if (eq item.system.craftsmanship "best")}}selected{{/if}}>Best</option>
                </select>
              </div>
              <div class="rt-field">
                <label>Weight (kg)</label>
                <input type="number" name="system.weight" value="{{item.system.weight}}" 
                       data-dtype="Number" min="0" step="0.1" />
              </div>
              <div class="rt-field">
                <label>Cost (Thrones)</label>
                <input type="number" name="system.cost" value="{{item.system.cost}}" 
                       data-dtype="Number" min="0" />
              </div>
            </div>
          </div>
        </div>

      </div>

      {{!-- PROPERTIES TAB --}}
      <div class="rt-armour-panel" data-tab="properties" data-group="primary">
        
        <div class="rt-armour-section">
          <div class="rt-armour-section__header">
            <i class="fas fa-star"></i>
            <h3>Special Properties</h3>
            {{#if item.system.hasProperties}}
            <span class="rt-armour-section__count">{{item.system.propertiesArray.length}}</span>
            {{/if}}
          </div>
          <div class="rt-armour-section__body">
            {{#if item.system.hasProperties}}
            <div class="rt-property-tags">
              {{#each item.system.propertiesArray as |prop|}}
              <div class="rt-property-tag">
                <span class="rt-property-tag__label">{{prop.label}}</span>
                <button type="button" class="rt-property-tag__remove" 
                        data-action="removeProperty" data-property="{{prop.id}}"
                        title="Remove property">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              {{/each}}
            </div>
            {{else}}
            <p class="rt-empty-text">No special properties</p>
            {{/if}}
            
            {{#if availableProperties}}
            <div class="rt-property-add">
              <select class="rt-property-add__select" name="new-property">
                <option value="">-- Add Property --</option>
                {{#each availableProperties as |prop key|}}
                <option value="{{key}}">{{prop.label}}</option>
                {{/each}}
              </select>
              <button type="button" class="rt-btn rt-btn--primary" data-action="addProperty">
                <i class="fas fa-plus"></i>
                Add
              </button>
            </div>
            {{/if}}
          </div>
        </div>

        {{!-- Property Descriptions --}}
        {{#if item.system.hasProperties}}
        <div class="rt-armour-section">
          <div class="rt-armour-section__header">
            <i class="fas fa-info-circle"></i>
            <h3>Property Descriptions</h3>
          </div>
          <div class="rt-armour-section__body">
            {{#each item.system.propertiesArray as |prop|}}
            <div class="rt-property-detail">
              <div class="rt-property-detail__name">
                <i class="fas fa-star"></i>
                {{prop.label}}
              </div>
              {{#if prop.description}}
              <div class="rt-property-detail__desc">{{prop.description}}</div>
              {{/if}}
            </div>
            {{/each}}
          </div>
        </div>
        {{/if}}

      </div>

      {{!-- MODIFICATIONS TAB --}}
      <div class="rt-armour-panel" data-tab="mods" data-group="primary">
        
        <div class="rt-armour-section">
          <div class="rt-armour-section__header">
            <i class="fas fa-wrench"></i>
            <h3>Modification Slots</h3>
            <span class="rt-armour-section__count">
              {{item.system.modifications.length}} / {{item.system.modificationSlots}}
            </span>
          </div>
          <div class="rt-armour-section__body">
            <div class="rt-mod-slots">
              <label>Total Slots:</label>
              <input type="number" name="system.modificationSlots" value="{{item.system.modificationSlots}}" 
                     data-dtype="Number" min="0" max="10" />
              <span class="rt-mod-slots__available">
                {{item.system.availableModSlots}} available
              </span>
            </div>
            
            {{#if item.system.modifications.length}}
            <div class="rt-mod-list">
              {{#each item.system.modifications as |mod idx|}}
              <div class="rt-mod-item">
                <div class="rt-mod-item__info">
                  <i class="fas fa-wrench"></i>
                  <span class="rt-mod-item__name">{{mod.name}}</span>
                </div>
                <div class="rt-mod-item__actions">
                  <button type="button" class="rt-btn rt-btn--secondary rt-btn--icon"
                          data-action="editMod" data-mod-index="{{idx}}"
                          title="Edit Modification">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button type="button" class="rt-btn rt-btn--secondary rt-btn--icon rt-btn--danger"
                          data-action="removeMod" data-mod-index="{{idx}}"
                          title="Remove Modification">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
              {{/each}}
            </div>
            {{else}}
            <div class="rt-empty-state rt-empty-state--mods">
              <i class="fas fa-wrench"></i>
              <span>No Modifications Installed</span>
              <p>Drag armour modification items here to install them.</p>
            </div>
            {{/if}}
            
            <button type="button" class="rt-btn rt-btn--primary rt-btn--full" data-action="addModification">
              <i class="fas fa-plus"></i>
              Add Modification
            </button>
          </div>
        </div>

      </div>

      {{!-- DESCRIPTION TAB --}}
      <div class="rt-armour-panel" data-tab="description" data-group="primary">
        
        {{!-- Effect --}}
        <div class="rt-armour-section">
          <div class="rt-armour-section__header">
            <i class="fas fa-bolt"></i>
            <h3>Effect</h3>
          </div>
          <div class="rt-armour-section__body rt-armour-section__body--editor">
            {{#if inEditMode}}
            {{editor content=system.effect target="system.effect" button=true editable=true engine="prosemirror"}}
            {{else}}
            <div class="rt-description-content">{{{system.effect}}}</div>
            {{/if}}
          </div>
        </div>

        {{!-- Description --}}
        <div class="rt-armour-section">
          <div class="rt-armour-section__header">
            <i class="fas fa-book"></i>
            <h3>Description</h3>
          </div>
          <div class="rt-armour-section__body rt-armour-section__body--editor">
            {{#if inEditMode}}
            {{editor content=system.description.value target="system.description.value" button=true editable=true engine="prosemirror"}}
            {{else}}
            <div class="rt-description-content">{{{system.description.value}}}</div>
            {{/if}}
          </div>
        </div>

        {{!-- Notes --}}
        <div class="rt-armour-section">
          <div class="rt-armour-section__header">
            <i class="fas fa-sticky-note"></i>
            <h3>Notes</h3>
          </div>
          <div class="rt-armour-section__body">
            <textarea name="system.notes" rows="4" placeholder="GM notes, acquisition details, etc.">{{item.system.notes}}</textarea>
          </div>
        </div>

        {{!-- Source --}}
        <div class="rt-armour-section">
          <div class="rt-armour-section__header">
            <i class="fas fa-book-open"></i>
            <h3>Source</h3>
          </div>
          <div class="rt-armour-section__body">
            <input type="text" name="system.source" value="{{item.system.source}}" 
                   placeholder="Rogue Trader Core Rulebook, pg. 123" />
          </div>
        </div>

      </div>

      {{!-- EFFECTS TAB --}}
      <div class="rt-armour-panel" data-tab="effects" data-group="primary">
        {{> systems/rogue-trader/templates/item/panel/active-effects-panel.hbs}}
      </div>

    </div>

  </form>
</div>
