{{!-- Enhanced NPC Threat Scaler Dialog Template --}}
{{!-- Phase 5: Enhanced threat scaling dialog with improved UX --}}

<form class="rt-threat-scaler-form">

  <!-- Header Section -->
  <div class="rt-scaler-header">
    <div class="rt-scaler-npc-info">
      <img src="{{actor.img}}" class="rt-scaler-npc-portrait" alt="{{actor.name}}" />
      <div class="rt-scaler-npc-identity">
        <h3>{{actor.name}}</h3>
        <div class="rt-scaler-current-threat">
          Current Threat: <strong>{{currentThreat}}</strong>
          <span class="rt-threat-tier-badge" style="background: {{currentTier.color}}">{{currentTier.label}}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Threat Slider Section -->
  <div class="rt-scaler-slider-section">
    <label for="newThreatLevel">New Threat Level</label>

    <div class="rt-slider-container">
      <input type="range"
             id="newThreatLevel"
             name="newThreatLevel"
             class="rt-threat-slider"
             min="1"
             max="30"
             value="{{newThreat}}"
             data-action="updatePreview" />
      <div class="rt-slider-marks">
        <span class="rt-slider-mark" data-value="1" style="left: 0%">
          <span class="rt-mark-tick"></span>
          <span class="rt-mark-label">1<br/>Minor</span>
        </span>
        <span class="rt-slider-mark" data-value="10" style="left: 30%">
          <span class="rt-mark-tick"></span>
          <span class="rt-mark-label">10<br/>Standard</span>
        </span>
        <span class="rt-slider-mark" data-value="15" style="left: 47%">
          <span class="rt-mark-tick"></span>
          <span class="rt-mark-label">15<br/>Tough</span>
        </span>
        <span class="rt-slider-mark" data-value="20" style="left: 63%">
          <span class="rt-mark-tick"></span>
          <span class="rt-mark-label">20<br/>Elite</span>
        </span>
        <span class="rt-slider-mark" data-value="30" style="left: 100%">
          <span class="rt-mark-tick"></span>
          <span class="rt-mark-label">30<br/>Boss</span>
        </span>
      </div>
    </div>

    <div class="rt-slider-value-display">
      <div class="rt-new-threat-value">{{newThreat}}</div>
      <div class="rt-new-threat-tier" style="background: {{newTier.color}}">{{newTier.label}}</div>
    </div>

    <!-- Quick Presets -->
    <div class="rt-quick-presets">
      <button type="button" class="rt-preset-btn" data-action="adjustThreat" data-amount="-5">
        <i class="fas fa-minus"></i> 5
      </button>
      <button type="button" class="rt-preset-btn" data-action="adjustThreat" data-amount="-1">
        <i class="fas fa-minus"></i> 1
      </button>
      <button type="button" class="rt-preset-btn rt-preset-reset" data-action="resetThreat">
        <i class="fas fa-undo"></i> Reset
      </button>
      <button type="button" class="rt-preset-btn" data-action="adjustThreat" data-amount="1">
        <i class="fas fa-plus"></i> 1
      </button>
      <button type="button" class="rt-preset-btn" data-action="adjustThreat" data-amount="5">
        <i class="fas fa-plus"></i> 5
      </button>
    </div>
  </div>

  <!-- Scaling Options -->
  <div class="rt-scaler-options">
    <h4>Scaling Options</h4>
    <div class="rt-options-grid">
      <label class="rt-checkbox-label">
        <input type="checkbox" name="scaleCharacteristics" {{#if scaleCharacteristics}}checked{{/if}} />
        <span>Characteristics</span>
      </label>
      <label class="rt-checkbox-label">
        <input type="checkbox" name="scaleWounds" {{#if scaleWounds}}checked{{/if}} />
        <span>Wounds</span>
      </label>
      <label class="rt-checkbox-label">
        <input type="checkbox" name="scaleSkills" {{#if scaleSkills}}checked{{/if}} />
        <span>Skills</span>
      </label>
      <label class="rt-checkbox-label">
        <input type="checkbox" name="scaleWeapons" {{#if scaleWeapons}}checked{{/if}} />
        <span>Weapons</span>
      </label>
      <label class="rt-checkbox-label">
        <input type="checkbox" name="scaleArmour" {{#if scaleArmour}}checked{{/if}} />
        <span>Armour</span>
      </label>
    </div>
  </div>

  <!-- Preview Section -->
  <div class="rt-scaler-preview">
    <h4>Preview Changes</h4>

    {{#if (gt threatDifference 10)}}
    <div class="rt-warning-banner">
      <i class="fas fa-exclamation-triangle"></i>
      <span>Large threat change ({{threatDifference}} levels) - review carefully!</span>
    </div>
    {{/if}}

    <!-- Tabs for different preview sections -->
    <nav class="rt-preview-tabs">
      <button type="button" class="rt-preview-tab active" data-tab="characteristics">Characteristics</button>
      <button type="button" class="rt-preview-tab" data-tab="combat">Combat</button>
      <button type="button" class="rt-preview-tab" data-tab="skills">Skills</button>
    </nav>

    <!-- Characteristics Preview -->
    <div class="rt-preview-section active" data-section="characteristics">
      <table class="rt-comparison-table">
        <thead>
          <tr>
            <th>Stat</th>
            <th>Current</th>
            <th></th>
            <th>New</th>
            <th>Change</th>
          </tr>
        </thead>
        <tbody>
          {{#each characteristicChanges}}
          <tr>
            <td class="rt-stat-name">{{short}}</td>
            <td class="rt-stat-current">{{current}}</td>
            <td class="rt-stat-arrow"><i class="fas fa-arrow-right"></i></td>
            <td class="rt-stat-new {{#if (gt change 0)}}increased{{else if (lt change 0)}}decreased{{/if}}">{{new}}</td>
            <td class="rt-stat-change {{#if (gt change 0)}}positive{{else if (lt change 0)}}negative{{else}}neutral{{/if}}">
              {{#if (gt change 0)}}+{{/if}}{{change}}
              <span class="rt-change-percent">({{percentChange}}%)</span>
            </td>
          </tr>
          {{/each}}
        </tbody>
      </table>
    </div>

    <!-- Combat Preview -->
    <div class="rt-preview-section" data-section="combat">
      <div class="rt-combat-changes">
        <div class="rt-change-row">
          <span class="rt-change-label">Wounds:</span>
          <span class="rt-change-current">{{currentWounds}}</span>
          <i class="fas fa-arrow-right"></i>
          <span class="rt-change-new">{{newWounds}}</span>
          <span class="rt-change-diff {{#if (gt woundsChange 0)}}positive{{else if (lt woundsChange 0)}}negative{{/if}}">
            {{#if (gt woundsChange 0)}}+{{/if}}{{woundsChange}}
          </span>
        </div>
        <div class="rt-change-row">
          <span class="rt-change-label">Armour:</span>
          <span class="rt-change-current">{{currentArmour}}</span>
          <i class="fas fa-arrow-right"></i>
          <span class="rt-change-new">{{newArmour}}</span>
          <span class="rt-change-diff {{#if (gt armourChange 0)}}positive{{else if (lt armourChange 0)}}negative{{/if}}">
            {{#if (gt armourChange 0)}}+{{/if}}{{armourChange}}
          </span>
        </div>
      </div>
    </div>

    <!-- Skills Preview -->
    <div class="rt-preview-section" data-section="skills">
      <p class="rt-preview-note">Skill levels will be adjusted based on characteristic changes.</p>
    </div>
  </div>

  <!-- Footer Buttons -->
  <footer class="rt-scaler-footer">
    <button type="button" class="rt-btn-secondary" data-action="cancel">
      <i class="fas fa-times"></i> Cancel
    </button>
    <button type="submit" class="rt-btn-primary">
      <i class="fas fa-check"></i> Apply Scaling
    </button>
  </footer>

</form>
